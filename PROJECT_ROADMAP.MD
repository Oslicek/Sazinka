# Project Roadmap - Sazinka v1.0 GA

> **Last Updated:** 2026-01-30

## Current State Analysis

**Backend (Rust Worker):**
- Customer handlers: 100% complete
- Device handlers: 100% complete âœ…
- Revision handlers: 100% complete âœ…
- Route handlers: 100% complete (planning works)

**Frontend (React):**
- Customers/CustomerDetail: Fully functional + Devices section âœ…
- Planner: Fully functional + drag/drop + save/load âœ…
- Admin: Fully functional + Export UI âœ…
- Settings: Fully functional (work, business, email, depots) âœ…
- Dashboard: Real stats from revision.stats âœ…
- Calendar: Fully functional with real data âœ…

**Database:** Schema complete for all 7 tables + communications table exists.

---

## Roadmap Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PHASE 1: Core Flow âœ… COMPLETE                       â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ Device CRUD  â”‚    â”‚ Revision CRUDâ”‚    â”‚  Dashboard   â”‚                 â”‚
â”‚   â”‚  Backend +   â”‚    â”‚  Backend +   â”‚    â”‚   Stats      â”‚                 â”‚
â”‚   â”‚  Frontend âœ… â”‚    â”‚  Frontend âœ… â”‚    â”‚      âœ…      â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PHASE 2: Smart Planning âœ… COMPLETE                     â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚  Functional  â”‚    â”‚ Smart Plan   â”‚    â”‚ Planner UX   â”‚                 â”‚
â”‚   â”‚  Calendar âœ… â”‚    â”‚ Suggest. âœ…  â”‚    â”‚ + Persist âœ… â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        PHASE 3: Users & Communication                        â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚    User      â”‚    â”‚  Settings    â”‚    â”‚   Export +   â”‚                 â”‚
â”‚   â”‚    Auth      â”‚    â”‚     UI       â”‚    â”‚    Email     â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            PHASE 4: CRM Evidence                             â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚   â”‚ Communicationâ”‚    â”‚   Visits     â”‚    â”‚  Customer    â”‚                 â”‚
â”‚   â”‚    Log       â”‚    â”‚  Tracking    â”‚    â”‚  Timeline    â”‚                 â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Phase 1: Core Flow (Devices, Revisions, Dashboard) âœ… COMPLETE

> **Completed:** 2026-01-30

### 1.1 Device Handlers âœ…

**Files created:**
- `worker/src/handlers/device.rs` âœ…
- `worker/src/db/queries/device.rs` âœ…
- `worker/src/types/device.rs` âœ…

**NATS subjects (all implemented):**
- `sazinka.device.create` âœ…
- `sazinka.device.list` âœ…
- `sazinka.device.get` âœ…
- `sazinka.device.update` âœ…
- `sazinka.device.delete` âœ…

### 1.2 Revision Handlers âœ…

**Files created:**
- `worker/src/handlers/revision.rs` âœ…
- `worker/src/db/queries/revision.rs` âœ…
- `worker/src/types/revision.rs` âœ…

**NATS subjects (all implemented):**
- `sazinka.revision.create` âœ…
- `sazinka.revision.list` âœ…
- `sazinka.revision.get` âœ…
- `sazinka.revision.update` âœ…
- `sazinka.revision.complete` âœ…
- `sazinka.revision.upcoming` âœ…
- `sazinka.revision.stats` âœ…

### 1.3 Device Management UI âœ…

**Files created:**
- `apps/web/src/services/deviceService.ts` âœ… (with TDD tests)
- `apps/web/src/components/devices/DeviceList.tsx` âœ…
- `apps/web/src/components/devices/DeviceForm.tsx` âœ…
- `apps/web/src/pages/CustomerDetail.tsx` - Devices section added âœ…

### 1.4 Revision Management UI âœ…

**Files created:**
- `apps/web/src/services/revisionService.ts` âœ… (with TDD tests)
- `apps/web/src/components/revisions/RevisionList.tsx` âœ…
- `apps/web/src/components/revisions/RevisionForm.tsx` âœ…
- `apps/web/src/components/revisions/CompleteRevisionDialog.tsx` âœ…

### 1.5 Dashboard with Real Data âœ…

**Stats displayed:**
- Overdue revisions count (red) âœ…
- Due this week count (yellow) âœ…
- Scheduled today count (green) âœ…
- Completed this month count âœ…

---

## Phase 2: Smart Planning (Calendar, Intelligent Suggestions) âœ… COMPLETE

> **Completed:** 2026-01-30

### 2.1 Functional Calendar âœ…

**Files created:**
- `apps/web/src/pages/Calendar.tsx` - Complete rewrite âœ…
- `apps/web/src/components/calendar/CalendarGrid.tsx` âœ…
- `apps/web/src/components/calendar/DayCell.tsx` âœ…
- `apps/web/src/utils/calendarUtils.ts` âœ… (18 TDD tests)

**Features implemented:**
- Month navigation âœ…
- Display scheduled revisions per day âœ…
- Color coding by revision count/status âœ…
- Click day to see details or navigate to planner âœ…

### 2.2 Smart Plan Suggestion âœ…

**Files created/modified:**
- `worker/src/handlers/revision.rs` - Added handle_suggest âœ…
- `worker/src/db/queries/revision.rs` - Added get_revision_suggestions âœ…
- `worker/src/types/revision.rs` - Added suggestion types âœ…
- `apps/web/src/services/revisionService.ts` - Added getSuggestedRevisions (+4 TDD tests) âœ…
- `apps/web/src/pages/Planner.tsx` - Replaced random selection âœ…

**NATS subject:**
- `sazinka.revision.suggest` âœ…

**Priority scoring implemented:**
| Priority | Score | Criteria |
|----------|-------|----------|
| Overdue | 100 | due_date < today |
| Due this week | 80 | due_date <= today + 7 days |
| Due soon | 60 | due_date <= today + 14 days |
| Due this month | 40 | due_date <= today + 30 days |
| Upcoming | 20 | due_date > today + 30 days |

### 2.3 Planner UX Improvements âœ…

**Files created/modified:**
- `apps/web/src/components/planner/SortableStopItem.tsx` âœ…
- `apps/web/src/components/planner/SortableStopItem.module.css` âœ…
- `apps/web/src/pages/Planner.tsx` - Added DndContext âœ…

**Features implemented:**
- Drag and drop reordering with @dnd-kit âœ…
- Lock/unlock individual stops âœ…
- Visual feedback during drag âœ…
- "Manually reordered" indicator âœ…

### 2.4 Route Persistence âœ…

**Files created/modified:**
- `worker/src/handlers/route.rs` - Added handle_save, handle_get âœ…
- `worker/src/db/queries/route.rs` - Added route_stops queries âœ…
- `apps/web/src/services/routeService.ts` âœ…

**NATS subjects:**
- `sazinka.route.save` - Save planned route âœ…
- `sazinka.route.get` - Load route for date âœ…

**Features implemented:**
- Save current route with stops to database âœ…
- Load saved route for selected date âœ…
- "Load" button appears when saved route exists âœ…
- Last saved timestamp display âœ…

---

## Phase 3: Users, Settings, Communication ğŸ”„ IN PROGRESS

### 3.1 User Authentication (Skipped - using mock user)

**Status:** Deferred - using TEMP_USER_ID for now

### 3.2 User Settings UI âœ…

**Files created:**
- `apps/web/src/pages/Settings.tsx` âœ…
- `apps/web/src/pages/Settings.module.css` âœ…

**Features implemented:**
- Tab-based settings UI âœ…
- Work constraints form (hours, max revisions, service duration) âœ…
- Business info form (name, contact, billing) âœ…
- Email templates form âœ…
- Depots manager (list, add, edit, delete, set primary) âœ…

### 3.3 Export CSV âœ…

**Files created:**
- `apps/web/src/services/exportService.ts` âœ…

**Export types implemented:**
- Customers export (CSV format matching import) âœ…
- Revisions export with date range and status filters âœ…
- Export UI in Admin page âœ…

### 3.4 Basic Email Reminders (Stretch Goal)

**Files to create:**
- `worker/src/services/email.rs` - NEW
- `worker/src/handlers/email.rs` - NEW

**Features:**
- Email templates (Handlebars)
- Resend API integration
- Manual send button per revision
- Communications log

---

## Phase 4: CRM Evidence (Communication & Visits)

### 4.1 Database Migration

**File:** `worker/migrations/20260130_000001_crm_enhancements.sql`

```sql
-- Extend communications table
ALTER TABLE communications
    ADD COLUMN user_id UUID NOT NULL REFERENCES users(id),
    ADD COLUMN contact_name VARCHAR(255),
    ADD COLUMN contact_phone VARCHAR(50),
    ADD COLUMN duration_minutes INTEGER,
    ADD COLUMN follow_up_date DATE,
    ADD COLUMN follow_up_done BOOLEAN DEFAULT FALSE;

-- New visits table
CREATE TABLE visits (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    customer_id UUID NOT NULL REFERENCES customers(id) ON DELETE CASCADE,
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    revision_id UUID REFERENCES revisions(id) ON DELETE SET NULL,
    visit_type VARCHAR(30) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'planned',
    scheduled_date DATE NOT NULL,
    scheduled_time TIME,
    actual_date DATE,
    actual_time TIME,
    duration_minutes INTEGER,
    result VARCHAR(30),
    summary TEXT,
    notes TEXT,
    created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
    updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### 4.2 Communication Handlers

**Files to create:**
- `worker/src/types/communication.rs` - NEW
- `worker/src/handlers/communication.rs` - NEW
- `worker/src/db/queries/communication.rs` - NEW

**NATS subjects:**
- `sazinka.communication.create` - Add record (call, email, note)
- `sazinka.communication.list` - List for customer (with filters)
- `sazinka.communication.get` - Get single record
- `sazinka.communication.update` - Update record
- `sazinka.communication.delete` - Delete record
- `sazinka.communication.follow_ups` - List pending follow-ups

**Communication types (`comm_type`):**
| Type | Description |
|------|-------------|
| `call_outbound` | Outgoing call |
| `call_inbound` | Incoming call |
| `email_sent` | Sent email |
| `email_received` | Received email |
| `sms_sent` | Sent SMS |
| `note` | Internal note |

### 4.3 Visit Handlers

**Files to create:**
- `worker/src/types/visit.rs` - NEW
- `worker/src/handlers/visit.rs` - NEW
- `worker/src/db/queries/visit.rs` - NEW

**NATS subjects:**
- `sazinka.visit.create` - Schedule visit
- `sazinka.visit.list` - List visits (filters: customer_id, date_range, status)
- `sazinka.visit.get` - Get visit details
- `sazinka.visit.update` - Update visit
- `sazinka.visit.complete` - Complete visit (with result)
- `sazinka.visit.cancel` - Cancel visit
- `sazinka.visit.upcoming` - Upcoming visits (for dashboard)

**Visit types (`visit_type`):**
| Type | Description |
|------|-------------|
| `revision` | Regular revision (links to revisions table) |
| `service` | Service call |
| `sales` | Sales meeting |
| `complaint` | Complaint handling |
| `consultation` | Consultation |
| `other` | Other |

### 4.4 Communication UI

**Files to create:**
```
apps/web/src/services/communicationService.ts (TDD)
apps/web/src/components/communications/
â”œâ”€â”€ CommunicationList.tsx      -- Timeline view
â”œâ”€â”€ CommunicationForm.tsx      -- Add record form
â”œâ”€â”€ CommunicationItem.tsx      -- Single timeline item
â”œâ”€â”€ QuickCallForm.tsx          -- Quick call entry
â”œâ”€â”€ QuickNoteForm.tsx          -- Quick note entry
â””â”€â”€ index.ts
```

### 4.5 Visit UI

**Files to create:**
```
apps/web/src/services/visitService.ts (TDD)
apps/web/src/components/visits/
â”œâ”€â”€ VisitList.tsx              -- Visit list
â”œâ”€â”€ VisitForm.tsx              -- Schedule visit form
â”œâ”€â”€ VisitCard.tsx              -- Visit card component
â”œâ”€â”€ CompleteVisitDialog.tsx    -- Complete visit dialog
â””â”€â”€ index.ts
```

### 4.6 Customer Timeline

**File:** `apps/web/src/components/customer/CustomerTimeline.tsx`

Unified chronological view showing:
- Communications (calls, emails, notes)
- Visits
- Revisions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Timeline: ABC s.r.o.                              [+ Add â–¼]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“ 30.1.2026 10:15  Outgoing call (5 min)                      â”‚
â”‚     "Scheduled visit for next week"                             â”‚
â”‚                                                                 â”‚
â”‚  ğŸ”§ 28.1.2026        Visit - Service (completed)                â”‚
â”‚     Filter replacement, all OK                                  â”‚
â”‚                                                                 â”‚
â”‚  ğŸ“ 25.1.2026 14:30  Note                                       â”‚
â”‚     "Customer prefers morning appointments"                     â”‚
â”‚                                                                 â”‚
â”‚  âœ… 15.1.2026        Gas boiler revision (passed)               â”‚
â”‚     No defects found                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.7 Dashboard Enhancements

Add to Dashboard:
- **Pending follow-ups** count + list
- **Today's visits** count + list
- **This week's visits** count

---

## Out of Scope for v1.0

Explicitly excluded:
- Mobile app
- Multi-tenant/team features
- Invoice generation
- Document attachments
- Incoming email processing
- Advanced reporting/analytics
- Multi-region support

---

## Implementation Order

```
Phase 1 (Core Flow): âœ… COMPLETE
  1.1 Device handlers + queries âœ…
  1.2 Revision handlers + queries âœ…
  1.3 Device UI in CustomerDetail âœ…
  1.4 Revision UI components âœ…
  1.5 Dashboard stats âœ…

Phase 2 (Smart Planning): ğŸ”„ IN PROGRESS
  2.1 Calendar with real data âœ…
  2.2 Smart plan suggestion algorithm âœ…
  2.3 Drag/drop + lock/unlock
  2.4 Route persistence

Phase 3 (Users & Comms):
  3.1 Authentication
  3.2 Settings UI (partially done)
  3.3 CSV export
  3.4 Email reminders (stretch goal)

Phase 4 (CRM Evidence):
  4.1 Database migration (communications + visits)
  4.2 Communication handlers (TDD)
  4.3 Visit handlers (TDD)
  4.4 Communication UI components
  4.5 Visit UI components
  4.6 Customer Timeline
  4.7 Dashboard enhancements
```

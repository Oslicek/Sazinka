# PRJ_DATA â€” Data Excise (GDPR Complete Data Deletion)

## Stav: IMPLEMENTOVÃNO

Tento dokument popisuje implementaci funkce **Data Excise** â€” trvalÃ©ho a nevratnÃ©ho smazÃ¡nÃ­ veÅ¡kerÃ½ch dat uÅ¾ivatelskÃ©ho ÃºÄtu. Funkce je vyÅ¾adovÃ¡na evropskÃ½m naÅ™Ã­zenÃ­m GDPR (ÄŒlÃ¡nek 17 â€” PrÃ¡vo na vÃ½maz) a dalÅ¡Ã­mi pÅ™edpisy o ochranÄ› osobnÃ­ch ÃºdajÅ¯.

---

## 1. Motivace

VlastnÃ­k ÃºÄtu (role `customer`) musÃ­ mÃ­t moÅ¾nost trvale odstranit veÅ¡kerÃ¡ svÃ¡ data ze systÃ©mu. JednÃ¡ se o tzv. **data excise** (Äesky **vyÅ™Ã­znutÃ­ dat**) â€” kompletnÃ­ a nevratnÃ© odstranÄ›nÃ­ vÅ¡ech zÃ¡znamÅ¯ bez moÅ¾nosti obnovenÃ­, a to ani ze strany technickÃ© podpory Ariadline.

### PrÃ¡vnÃ­ rÃ¡mec

- **GDPR Äl. 17** â€” PrÃ¡vo na vÃ½maz ("prÃ¡vo bÃ½t zapomenut")
- **GDPR Äl. 20** â€” PrÃ¡vo na pÅ™enositelnost ÃºdajÅ¯ (export pÅ™ed smazÃ¡nÃ­m)
- UÅ¾ivatel musÃ­ bÃ½t pÅ™ed smazÃ¡nÃ­m informovÃ¡n o nevratnosti operace
- SystÃ©m nesmÃ­ uchovÃ¡vat kopie smazanÃ½ch dat (Å¾Ã¡dnÃ½ soft delete, Å¾Ã¡dnÃ½ koÅ¡)

---

## 2. UmÃ­stÄ›nÃ­ v UI

### Settings â†’ Import/export â†’ Danger Zone (spodnÃ­ ÄÃ¡st)

Na konci zÃ¡loÅ¾ky Import/export se zobrazÃ­ vÃ½raznÄ› oddÄ›lenÃ¡ sekce:

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸  DANGER ZONE â€” NEBEZPEÄŒNÃ ZÃ“NA
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ—‘ï¸ Data Excise â€” VyÅ™Ã­znutÃ­ dat

Trvale a nevratnÄ› smaÅ¾e vÃ¡Å¡ ÃºÄet a veÅ¡kerÃ¡ souvisejÃ­cÃ­ data.
Tuto akci nelze vrÃ¡tit zpÄ›t. Ani podpora Ariadline nemÅ¯Å¾e
obnovit data odstranÄ›nÃ¡ tÃ­mto zpÅ¯sobem.

        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  ğŸ—‘ï¸ Smazat vÅ¡echna moje data â”‚  â† velkÃ© ÄervenÃ© tlaÄÃ­tko
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Viditelnost:** Pouze pro vlastnÃ­ka ÃºÄtu (`role === 'customer'`, `owner_id === null`). PracovnÃ­ci (workers) tuto sekci nevidÃ­.

---

## 3. UX Flow â€” TÅ™i kroky

### Krok 1: KliknutÃ­ na ÄervenÃ© tlaÄÃ­tko

OtevÅ™e se prvnÃ­ dialog.

### Krok 2: Dialog 1 â€” Export a varovÃ¡nÃ­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  DATA EXCISE â€” VyÅ™Ã­znutÃ­ dat                        â”‚
â”‚                                                         â”‚
â”‚  Tato operace TRVALE A NEVRATNÄš smaÅ¾e:                  â”‚
â”‚                                                         â”‚
â”‚    â€¢ VÅ¡echny zÃ¡kaznÃ­ky a jejich kontaktnÃ­ Ãºdaje          â”‚
â”‚    â€¢ VÅ¡echna zaÅ™Ã­zenÃ­ a historii revizÃ­                  â”‚
â”‚    â€¢ VÅ¡echny trasy, nÃ¡vÅ¡tÄ›vy a pracovnÃ­ zÃ¡znamy          â”‚
â”‚    â€¢ VÅ¡echny zÃ¡znamy komunikace                          â”‚
â”‚    â€¢ VÅ¡echna nastavenÃ­, posÃ¡dky, depa, e-mailovÃ© Å¡ablony â”‚
â”‚    â€¢ VÃ¡Å¡ uÅ¾ivatelskÃ½ ÃºÄet a vÅ¡echny ÃºÄty pracovnÃ­kÅ¯      â”‚
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ â›” Tato akce je NEVRATNÃ.                       â”‚    â”‚
â”‚  â”‚ Data budou definitivnÄ› vyÅ™Ã­znuta ze systÃ©mu.     â”‚    â”‚
â”‚  â”‚ Ani podpora Ariadline nemÅ¯Å¾e obnovit data        â”‚    â”‚
â”‚  â”‚ odstranÄ›nÃ¡ tÃ­mto zpÅ¯sobem.                       â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â”‚  DoporuÄujeme si pÅ™ed smazÃ¡nÃ­m stÃ¡hnout kompletnÃ­       â”‚
â”‚  zÃ¡lohu vaÅ¡ich dat:                                     â”‚
â”‚                                                         â”‚
â”‚  [ ğŸ“¥ StÃ¡hnout kompletnÃ­ export dat ]                   â”‚
â”‚                                                         â”‚
â”‚  [ ZruÅ¡it ]              [ PokraÄovat ke smazÃ¡nÃ­ â†’ ]    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

TlaÄÃ­tko "StÃ¡hnout" spustÃ­ full export (existujÃ­cÃ­ mechanismus ExportPlus, scope `all_workers_combined`, formÃ¡t ZIP).

### Krok 3: Dialog 2 â€” PotvrzenÃ­ PINem

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â›”  ZÃVÄšREÄŒNÃ‰ POTVRZENÃ                                â”‚
â”‚                                                         â”‚
â”‚  Pro potvrzenÃ­ vyÅ™Ã­znutÃ­ dat zadejte tento kÃ³d:          â”‚
â”‚                                                         â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â”‚     7  3  9  2    â”‚  â† nÃ¡hodnÃ½ 4-cifernÃ½  â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       PIN              â”‚
â”‚                                                         â”‚
â”‚  Zadejte kÃ³d: [ __________ ]                            â”‚
â”‚                                                         â”‚
â”‚  [ ZruÅ¡it ]          [ ğŸ—‘ï¸ DefinitivnÄ› smazat vÅ¡e ]      â”‚
â”‚                      â†‘ neaktivnÃ­ dokud PIN nesouhlasÃ­    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

PIN je generovÃ¡n na klientu (4 nÃ¡hodnÃ© cifry). NeslouÅ¾Ã­ jako bezpeÄnostnÃ­ mechanismus (autorizace je pÅ™es JWT), ale jako UX bariÃ©ra proti nechtÄ›nÃ©mu kliknutÃ­.

---

## 4. Backend

### 4.1 NATS subject

```
sazinka.account.delete
```

### 4.2 Request/Response

**Request payload:**
```json
{
  "confirmation": true,
  "level": 1
}
```

- `level: 1` â€” smazat firemnÃ­ data, zachovat uÅ¾ivatelskÃ½ ÃºÄet (start fresh)
- `level: 2` â€” smazat vÅ¡e vÄetnÄ› uÅ¾ivatelskÃ©ho ÃºÄtu (plnÃ½ data excise)

**Success response:**
```json
{
  "deleted": true,
  "message": "settings:delete_data_success",
  "level": 1
}
```

### 4.3 Handler logika

1. OvÄ›Å™it JWT â€” musÃ­ bÃ½t `role = "customer"` a `owner_id IS NULL` (vlastnÃ­k ÃºÄtu)
2. OvÄ›Å™it `level` (1 nebo 2) a `confirmation = true`
3. **Audit log** â€” zapsat do server logu: level, user ID, email, timestamp (pÅ™ed smazÃ¡nÃ­m)
4. **Level 1** (`delete_company_data`):
   ```sql
   DELETE FROM users WHERE owner_id = $1;       -- worker ÃºÄty
   DELETE FROM roles WHERE owner_id = $1;        -- role + oprÃ¡vnÄ›nÃ­
   DELETE FROM routes WHERE user_id = $1;        -- trasy + zastÃ¡vky
   DELETE FROM customers WHERE user_id = $1;     -- zÃ¡kaznÃ­ci + CASCADE
   DELETE FROM depots WHERE user_id = $1;        -- depa
   DELETE FROM crews WHERE user_id = $1;         -- posÃ¡dky
   UPDATE users SET default_crew_id = NULL, default_depot_id = NULL, ... WHERE id = $1;
   ```
5. **Level 2** (`delete_user_account`):
   - Nejprve provede Level 1
   - PotÃ©: `DELETE FROM users WHERE id = $1;`
6. VrÃ¡tit ÃºspÄ›ch
7. Frontend:
   - Level 1: `window.location.reload()` (uÅ¾ivatel zÅ¯stane pÅ™ihlÃ¡Å¡en)
   - Level 2: `logout()` â†’ redirect na `/login`

### 4.4 CASCADE Å™etÄ›zce (existujÃ­cÃ­ FK)

DÃ­ky `ON DELETE CASCADE` definovanÃ©mu ve schÃ©matu staÄÃ­ smazat Å™Ã¡dek z `users`:

```
users (DELETE)
  â”œâ”€â”€ customers (CASCADE)
  â”‚     â”œâ”€â”€ devices (CASCADE)
  â”‚     â”‚     â””â”€â”€ revisions (CASCADE)
  â”‚     â”‚           â””â”€â”€ visit_work_items (via revision_id, SET NULL)
  â”‚     â”œâ”€â”€ revisions (via customer_id, CASCADE)
  â”‚     â”œâ”€â”€ visits (via customer_id, CASCADE)
  â”‚     â”‚     â””â”€â”€ visit_work_items (CASCADE)
  â”‚     â”œâ”€â”€ communications (CASCADE)
  â”‚     â””â”€â”€ route_stops (CASCADE)
  â”œâ”€â”€ devices (via user_id, CASCADE)
  â”œâ”€â”€ revisions (via user_id, CASCADE)
  â”œâ”€â”€ visits (via user_id, CASCADE)
  â”œâ”€â”€ communications (via user_id, CASCADE)
  â”œâ”€â”€ routes (CASCADE)
  â”‚     â””â”€â”€ route_stops (CASCADE)
  â”œâ”€â”€ depots (CASCADE)
  â”œâ”€â”€ crews (CASCADE)
  â”œâ”€â”€ roles (via owner_id, CASCADE)
  â”‚     â”œâ”€â”€ role_permissions (CASCADE)
  â”‚     â””â”€â”€ user_roles (CASCADE)
  â””â”€â”€ users (workers via owner_id, CASCADE)
```

### 4.5 BezpeÄnost

- **Pouze vlastnÃ­k:** Handler odmÃ­tne request od workerÅ¯ a adminÅ¯
- **Audit trail:** `warn!()` log s emailem a timestampem pÅ™ed DELETE
- **Rate limiting:** Max 1 pokus za 60 sekund
- **Hard delete:** Å½Ã¡dnÃ½ soft delete, Å¾Ã¡dnÃ½ koÅ¡, Å¾Ã¡dnÃ© tombstony â€” plnÃ½ soulad s GDPR Äl. 17
- **JetStream cleanup:** Po smazÃ¡nÃ­ uÅ¾ivatele by mÄ›ly bÃ½t vyÄiÅ¡tÄ›ny i pÅ™Ã­padnÃ© pending joby v NATS JetStream (import, export, geocoding)

---

## 5. Soubory k vytvoÅ™enÃ­ / ÃºpravÄ›

### NovÃ© soubory

| Soubor | Popis |
|--------|-------|
| `apps/web/src/components/settings/DeleteAccountDialog.tsx` | Dvou-krokovÃ½ modÃ¡lnÃ­ dialog |
| `apps/web/src/components/settings/DeleteAccountDialog.module.css` | Danger-zone styling (ÄervenÃ¡, vÃ½straÅ¾nÃ¡) |

### Ãšpravy existujÃ­cÃ­ch souborÅ¯

| Soubor | ZmÄ›na |
|--------|-------|
| `apps/web/src/pages/Settings.tsx` | PÅ™idat Danger Zone sekci na konec `import-export` zÃ¡loÅ¾ky |
| `apps/web/src/pages/Settings.module.css` | PÅ™idat styly pro danger zone |
| `apps/web/src/services/settingsService.ts` | PÅ™idat `deleteAccount()` funkci |
| `apps/web/public/locales/en/settings.json` | PÅ™idat ~20 novÃ½ch klÃ­ÄÅ¯ |
| `apps/web/public/locales/cs/settings.json` | PÅ™idat ~20 novÃ½ch klÃ­ÄÅ¯ |
| `apps/web/public/locales/sk/settings.json` | PÅ™idat ~20 novÃ½ch klÃ­ÄÅ¯ |
| `worker/src/handlers/settings.rs` | PÅ™idat `handle_delete_account` handler |
| `worker/src/db/queries/settings.rs` | PÅ™idat `delete_user_account` query |
| `worker/src/main.rs` | Registrovat novÃ½ NATS subscription |

---

## 6. PÅ™ekladovÃ© klÃ­Äe

### Namespace: `settings`

| KlÃ­Ä | EN | CS | SK |
|------|----|----|-----|
| `danger_zone` | Danger Zone | NebezpeÄnÃ¡ zÃ³na | NebezpeÄnÃ¡ zÃ³na |
| **Level 1 â€” Data only** | | | |
| `delete_data_title` | Delete Company Data | Smazat firemnÃ­ data | VymazaÅ¥ firemnÃ© dÃ¡ta |
| `delete_data_desc` | Delete all customers, devices, ... Your user account will be preserved. | SmaÅ¾e vÅ¡echny zÃ¡kaznÃ­ky, ... VÃ¡Å¡ ÃºÄet zÅ¯stane zachovÃ¡n. | VymaÅ¾e vÅ¡etkÃ½ch zÃ¡kaznÃ­kov, ... VÃ¡Å¡ ÃºÄet zostane zachovanÃ½. |
| `delete_data_button` | Delete all data | Smazat vÅ¡echna data | VymazaÅ¥ vÅ¡etky dÃ¡ta |
| `delete_data_dialog_title` | Delete Company Data | SmazÃ¡nÃ­ firemnÃ­ch dat | Vymazanie firemnÃ½ch dÃ¡t |
| `delete_data_dialog_warning` | This operation will PERMANENTLY delete all your company data: | Tato operace TRVALE smaÅ¾e veÅ¡kerÃ¡ vaÅ¡e firemnÃ­ data: | TÃ¡to operÃ¡cia TRVALO vymaÅ¾e vÅ¡etky vaÅ¡e firemnÃ© dÃ¡ta: |
| `delete_data_dialog_irreversible` | ... Your user account and login credentials will be preserved. | ... VÃ¡Å¡ ÃºÄet a pÅ™ihlaÅ¡ovacÃ­ Ãºdaje zÅ¯stanou zachovÃ¡ny. | ... VÃ¡Å¡ ÃºÄet a prihlasovacie Ãºdaje zostanÃº zachovanÃ©. |
| `delete_data_confirm_button` | Permanently delete all data | DefinitivnÄ› smazat vÅ¡echna data | DefinitÃ­vne vymazaÅ¥ vÅ¡etky dÃ¡ta |
| `delete_data_success` | All company data has been permanently deleted. Your account is preserved. | VeÅ¡kerÃ¡ firemnÃ­ data byla trvale smazÃ¡na. VÃ¡Å¡ ÃºÄet je zachovÃ¡n. | VÅ¡etky firemnÃ© dÃ¡ta boli trvalo vymazanÃ©. VÃ¡Å¡ ÃºÄet je zachovanÃ½. |
| **Level 2 â€” Data + Account** | | | |
| `delete_all_title` | Data Excise â€” Delete Account | VyÅ™Ã­znutÃ­ dat â€” SmazÃ¡nÃ­ ÃºÄtu | Vyrezanie dÃ¡t â€” Vymazanie ÃºÄtu |
| `delete_all_desc` | Permanently and irreversibly delete your account and all associated data. | Trvale a nevratnÄ› smaÅ¾e vÃ¡Å¡ ÃºÄet a veÅ¡kerÃ¡ souvisejÃ­cÃ­ data. | Trvalo a nenÃ¡vratne vymaÅ¾e vÃ¡Å¡ ÃºÄet a vÅ¡etky sÃºvisiace dÃ¡ta. |
| `delete_all_button` | Delete account and all data | Smazat ÃºÄet a vÅ¡echna data | VymazaÅ¥ ÃºÄet a vÅ¡etky dÃ¡ta |
| `delete_dialog_title` | Data Excise â€” Delete Account | VyÅ™Ã­znutÃ­ dat â€” SmazÃ¡nÃ­ ÃºÄtu | Vyrezanie dÃ¡t â€” Vymazanie ÃºÄtu |
| `delete_dialog_warning` | This operation will PERMANENTLY AND IRREVERSIBLY delete: | Tato operace TRVALE A NEVRATNÄš smaÅ¾e: | TÃ¡to operÃ¡cia TRVALO A NENÃVRATNE vymaÅ¾e: |
| `delete_dialog_item_customers` | All customers and their contact information | VÅ¡echny zÃ¡kaznÃ­ky a jejich kontaktnÃ­ Ãºdaje | VÅ¡etkÃ½ch zÃ¡kaznÃ­kov a ich kontaktnÃ© Ãºdaje |
| `delete_dialog_item_devices` | All devices and revision history | VÅ¡echna zaÅ™Ã­zenÃ­ a historii revizÃ­ | VÅ¡etky zariadenia a histÃ³riu revÃ­ziÃ­ |
| `delete_dialog_item_routes` | All routes, visits, and work logs | VÅ¡echny trasy, nÃ¡vÅ¡tÄ›vy a pracovnÃ­ zÃ¡znamy | VÅ¡etky trasy, nÃ¡vÅ¡tevy a pracovnÃ© zÃ¡znamy |
| `delete_dialog_item_comms` | All communication records | VÅ¡echny zÃ¡znamy komunikace | VÅ¡etky zÃ¡znamy komunikÃ¡cie |
| `delete_dialog_item_settings` | All settings, crews, depots, and email templates | VÅ¡echna nastavenÃ­, posÃ¡dky, depa a e-mailovÃ© Å¡ablony | VÅ¡etky nastavenia, posÃ¡dky, depÃ¡ a e-mailovÃ© Å¡ablÃ³ny |
| `delete_dialog_item_accounts` | Your user account and all worker accounts | VÃ¡Å¡ uÅ¾ivatelskÃ½ ÃºÄet a vÅ¡echny ÃºÄty pracovnÃ­kÅ¯ | VÃ¡Å¡ pouÅ¾Ã­vateÄ¾skÃ½ ÃºÄet a vÅ¡etky ÃºÄty pracovnÃ­kov |
| `delete_dialog_irreversible` | This action is IRREVERSIBLE. Data will be definitively excised from the system. Even Ariadline support cannot recover data removed this way. | Tato akce je NEVRATNÃ. Data budou definitivnÄ› vyÅ™Ã­znuta ze systÃ©mu. Ani podpora Ariadline nemÅ¯Å¾e obnovit data odstranÄ›nÃ¡ tÃ­mto zpÅ¯sobem. | TÃ¡to akcia je NENÃVRATNÃ. DÃ¡ta budÃº definitÃ­vne vyrezanÃ© zo systÃ©mu. Ani podpora Ariadline nemÃ´Å¾e obnoviÅ¥ dÃ¡ta odstrÃ¡nenÃ© tÃ½mto spÃ´sobom. |
| `delete_dialog_download_hint` | We recommend downloading a complete backup of your data before deletion: | DoporuÄujeme si pÅ™ed smazÃ¡nÃ­m stÃ¡hnout kompletnÃ­ zÃ¡lohu vaÅ¡ich dat: | OdporÃºÄame si pred vymazanÃ­m stiahnuÅ¥ kompletnÃº zÃ¡lohu vaÅ¡ich dÃ¡t: |
| `delete_dialog_download_btn` | Download full data export | StÃ¡hnout kompletnÃ­ export dat | StiahnuÅ¥ kompletnÃ½ export dÃ¡t |
| `delete_dialog_continue` | Continue to deletion | PokraÄovat ke smazÃ¡nÃ­ | PokraÄovaÅ¥ k vymazaniu |
| `delete_confirm_title` | Final Confirmation | ZÃ¡vÄ›reÄnÃ© potvrzenÃ­ | ZÃ¡vereÄnÃ© potvrdenie |
| `delete_confirm_instruction` | To confirm the data excise, type this code: | Pro potvrzenÃ­ vyÅ™Ã­znutÃ­ dat zadejte tento kÃ³d: | Pre potvrdenie vyrezania dÃ¡t zadajte tento kÃ³d: |
| `delete_confirm_input_label` | Enter code | Zadejte kÃ³d | Zadajte kÃ³d |
| `delete_confirm_button` | Permanently delete everything | DefinitivnÄ› smazat vÅ¡e | DefinitÃ­vne vymazaÅ¥ vÅ¡etko |
| `delete_success` | Your data has been permanently deleted. | VaÅ¡e data byla trvale smazÃ¡na. | VaÅ¡e dÃ¡ta boli trvalo vymazanÃ©. |
| `delete_error` | Failed to delete data. Please try again or contact support. | NepodaÅ™ilo se smazat data. Zkuste to znovu nebo kontaktujte podporu. | Nepodarilo sa vymazaÅ¥ dÃ¡ta. SkÃºste to znova alebo kontaktujte podporu. |

---

## 7. ImplementaÄnÃ­ kroky

### FÃ¡ze 1: Backend
1. PÅ™idat `delete_user_account` SQL query do `worker/src/db/queries/settings.rs`
2. PÅ™idat `handle_delete_account` handler do `worker/src/handlers/settings.rs`
3. Registrovat `sazinka.account.delete` subscription v `worker/src/main.rs`
4. `cargo check` â€” ovÄ›Å™it kompilaci

### FÃ¡ze 2: Frontend service
5. PÅ™idat `deleteAccount()` do `apps/web/src/services/settingsService.ts`

### FÃ¡ze 3: UI komponenty
6. VytvoÅ™it `DeleteAccountDialog.tsx` + `DeleteAccountDialog.module.css`
7. PÅ™idat Danger Zone sekci do `Settings.tsx` (zÃ¡loÅ¾ka import-export)
8. PÅ™idat styly do `Settings.module.css`

### FÃ¡ze 4: PÅ™eklady
9. PÅ™idat vÅ¡echny klÃ­Äe do `en/settings.json`, `cs/settings.json`, `sk/settings.json`

### FÃ¡ze 5: OvÄ›Å™enÃ­
10. ManuÃ¡lnÃ­ test celÃ©ho flow
11. OvÄ›Å™it, Å¾e po smazÃ¡nÃ­ je uÅ¾ivatel odhlÃ¡Å¡en a nemÅ¯Å¾e se pÅ™ihlÃ¡sit

---

## 8. ImplementaÄnÃ­ log

| Datum | FÃ¡ze | Popis |
|-------|------|-------|
| 2026-02-15 | NÃ¡vrh | VytvoÅ™en PRJ_DATA.MD s kompletnÃ­m nÃ¡vrhem |
| 2026-02-15 | Backend | Typy `DeleteAccountRequest`/`DeleteAccountResponse` v `types/settings.rs` |
| 2026-02-15 | Backend | SQL query `delete_user_account` v `db/queries/settings.rs` |
| 2026-02-15 | Backend | Handler `handle_delete_account` v `handlers/settings.rs` |
| 2026-02-15 | Backend | NATS subscription `sazinka.account.delete` v `handlers/mod.rs` |
| 2026-02-15 | Backend | `cargo check` â€” kompilace OK |
| 2026-02-15 | Frontend | `deleteAccount()` v `services/settingsService.ts` |
| 2026-02-15 | Frontend | `DeleteAccountDialog.tsx` + `DeleteAccountDialog.module.css` |
| 2026-02-15 | Frontend | `DangerZoneSection` integrovÃ¡na do Settings.tsx (import-export tab) |
| 2026-02-15 | PÅ™eklady | VÅ¡echny klÃ­Äe pÅ™idÃ¡ny do `en/settings.json`, `cs/settings.json`, `sk/settings.json` |
| 2026-02-15 | Redesign | DvÄ› ÃºrovnÄ›: Level 1 (data only) + Level 2 (data + account) |
| 2026-02-15 | Backend | `delete_company_data` query (Level 1) â€” maÅ¾e data, zachovÃ¡vÃ¡ ÃºÄet |
| 2026-02-15 | Backend | `delete_user_account` volÃ¡ Level 1 + smaÅ¾e user row (Level 2) |
| 2026-02-15 | Backend | Handler rozliÅ¡uje `level: 1` vs `level: 2` v requestu |
| 2026-02-15 | Frontend | `deleteCompanyData()` (Level 1) + `deleteAccount()` (Level 2) v settingsService |
| 2026-02-15 | Frontend | DangerZoneSection: dva tlaÄÃ­tka (oranÅ¾ovÃ© L1, ÄervenÃ© L2) |
| 2026-02-15 | Frontend | DeleteAccountDialog: adaptivnÃ­ UI podle levelu (barvy, texty, chovÃ¡nÃ­ po smazÃ¡nÃ­) |
| 2026-02-15 | PÅ™eklady | PÅ™idÃ¡no 8 novÃ½ch klÃ­ÄÅ¯ pro Level 1 ve vÅ¡ech 3 jazycÃ­ch |

---

*PoslednÃ­ aktualizace: 2026-02-15*

# Ariadline production Caddyfile — VPS (Hetzner)
#
# This Caddy instance handles ONLY:
#   api.ariadline.com     — NATS WebSocket proxy (wss:// → ws://)
#   monitor.ariadline.com — NATS monitoring dashboard (basic auth)
#
# Static sites (ariadline.com, app.ariadline.com) are hosted on Cloudflare Pages.
# ariadline.cz redirects to ariadline.com.
# Caddy handles automatic TLS via Let's Encrypt.

# api.ariadline.com — NATS WebSocket proxy
api.ariadline.com {
    reverse_proxy /nats nats:8222

    handle {
        respond "Not Found" 404
    }

    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        Referrer-Policy "strict-origin-when-cross-origin"
    }
}

# monitor.ariadline.com — NATS monitoring (password protected)
monitor.ariadline.com {
    basic_auth {
        admin {$MONITOR_PASSWORD_HASH}
    }
    reverse_proxy nats:8223
}

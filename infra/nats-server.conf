# NATS Server Configuration for Sazinka

# Server identification (required for JetStream)
server_name: sazinka-nats-1

# Client connections
port: 4222

# Authentication — separate tokens for worker (full access) and browser (restricted)
authorization {
  users: [
    # Backend worker — full access to all subjects
    {
      user: worker
      password: workerpass
      permissions: {
        publish: ">"
        subscribe: ">"
      }
    }
    # Browser clients — restricted to request/response pattern only
    {
      user: browser
      password: browserpass
      permissions: {
        publish: ["sazinka.>"]
        subscribe: ["_INBOX.>", "sazinka.>"]
      }
    }
  ]
}

# WebSocket for browser clients
websocket {
  port: 8222
  no_tls: true  # TODO: Enable TLS for production (Phase 2 — PLAN-13)
}

# Cluster routing disabled for single-node setup
# cluster {
#   name: sazinka-cluster
#   port: 6222
# }

# JetStream for persistent messaging and queuing
jetstream {
  store_dir: "/data/jetstream"
  max_memory_store: 512MB
  max_file_store: 4GB
}

# Logging
debug: false
trace: false
logtime: true

# Limits
max_payload: 8MB
max_connections: 1000

# Monitoring — bind to all interfaces (accessible for healthcheck)
http: 8223

# Sazinka - Workflow & UI Koncept

> **Status:** MVP kompletnÃ­ + Phase 9 (Planner redesign) + sjednocenÃ­ komponent + Smart Slot Heuristics (multi-crew, Valhalla) + Auto-recalculation + Chronological insertion & break constraints + Routing accuracy fixes + Timeline UX improvements  
> **Verze:** 0.8.4  
> **Datum:** 2026-02-12
> 
> **ImplementovÃ¡no:**
> - âœ… Fronta k obvolÃ¡nÃ­ (`/queue`) - filtry, statistiky, akce
> - âœ… Dialog pro plÃ¡novÃ¡nÃ­ nÃ¡vÅ¡tÄ›vy (datum, ÄasovÃ© okno, dÃ©lka)
> - âœ… Dialog pro odloÅ¾enÃ­ (snooze)
> - âœ… KalendÃ¡Å™ - pÅ™epÃ­naÄ TermÃ­ny/NaplÃ¡novanÃ©
> - âœ… **PlÃ¡n dne** (`/planner`) - slouÄenÃ¡ strÃ¡nka PlÃ¡novÃ¡nÃ­ + MÅ¯j den:
>   - Mapa s trasou + statistiky
>   - Seznam zastÃ¡vek s akcemi (navigovat, volat, hotovo)
>   - Google Maps export (single + segmented)
>   - Tisk/PDF
>   - NÃ¡hled fronty k obvolÃ¡nÃ­
> - âœ… Smart Slots - inteligentnÃ­ nÃ¡vrhy ÄasovÃ½ch slotÅ¯ podle existujÃ­cÃ­ trasy
> - âœ… Detail revize (`/revisions/:id`) - workflow hub
> - âœ… Dashboard - clickable stats, CTA fronta k obvolÃ¡nÃ­
> - âœ… **SjednocenÃ© komponenty Inbox/Planner** â€” `RouteDetailTimeline` + `RouteMapPanel` sdÃ­lenÃ© obÄ›ma strÃ¡nkami
> - âœ… **Bidirectional highlight** â€” klik na zastÃ¡vku/segment v timeline â†” zvÃ½raznÄ›nÃ­ na mapÄ›
> - âœ… **InsertionPreview** â€” vizualizace vloÅ¾enÃ­ kandidÃ¡ta do trasy na mapÄ› (Inbox only)
> - âœ… **Export+ asynchronnÄ›** â€” export joby bÄ›Å¾Ã­ na workeru a v `Ãšlohy` lze dokonÄenÃ½ export stÃ¡hnout pÅ™es `StÃ¡hnout export`
> - âœ… **NÃ¡zev export ZIP podle timezone uÅ¾ivatele** â€” `export-YYYYMMDD-HHMMSS-XX.zip` (Äas ve jmÃ©nÄ› respektuje timezone uÅ¾ivatele, kterÃ½ export spustil)
> - âœ… **ZÃ¡znam prÃ¡ce V1** (`/worklog`) â€” rychlÃ½ zÃ¡znam nÃ¡vÅ¡tÄ›vy, rychlÃ© dokonÄenÃ­ plÃ¡novanÃ©/probÃ­hajÃ­cÃ­ nÃ¡vÅ¡tÄ›vy, zachovanÃ© prokliky na den v kalendÃ¡Å™i / nÃ¡vÅ¡tÄ›vu / zÃ¡kaznÃ­ka, vÄetnÄ› mobilnÄ›-responsivnÃ­ho layoutu
> - âœ… **Auto-recalculation** â€” automatickÃ½ pÅ™epoÄet ETAs/ETDs po kaÅ¾dÃ©m vloÅ¾enÃ­ zastÃ¡vky nebo drag-and-drop pÅ™esunutÃ­ pomocÃ­ `sazinka.route.recalculate` (Valhalla matrix + sequential schedule)
> - âœ… **Chronological insertion** â€” novÃ© zastÃ¡vky se automaticky vklÃ¡dajÃ­ v chronologickÃ©m poÅ™adÃ­ podle `scheduledTimeStart`, nikoliv na konec trasy
> - âœ… **Break constraint enforcement** â€” pauza respektuje nakonfigurovanÃ© ÄasovÃ© okno (napÅ™. 11:30-13:00) a vklÃ¡dÃ¡ se do sprÃ¡vnÃ© mezery mezi zastÃ¡vkami, ne hned po pÅ™edchozÃ­ zastÃ¡vce
> - âœ… **Valhalla routing accuracy** â€” snapping radius snÃ­Å¾en z 50 km na 500 m (eliminuje detours zpÅ¯sobenÃ© mock geocodingem); break zastÃ¡vky (bez souÅ™adnic) jsou vylouÄeny z Valhalla matrix poÅ¾adavku, aby nezpÅ¯sobovaly fallback na MockRoutingService (40 km/h)
> - âœ… **Break chronological placement** â€” pÅ™i vÃ½bÄ›ru pozice pauzy se preferujÃ­ mezery, kam pauza chronologicky patÅ™Ã­ (`chronoFit`), takÅ¾e pauza v 11:30 se nevloÅ¾Ã­ pÅ™ed zastÃ¡vku v 08:00
> - âœ… **Timeline height halved + hourly labels** â€” vÃ½Å¡ka plÃ¡novacÃ­ timeline snÃ­Å¾ena na polovinu (`PIXELS_PER_MINUTE: 1.25`), vlevo pÅ™idÃ¡ny hodinovÃ© znaÄky
> - âœ… **Collapsible/expandable map** â€” mapa v Inboxu lze sbalit (zobrazit jen timeline) nebo rozbalit na celou strÃ¡nku
> - âœ… **Insertion preview deduplication** â€” opravena duplicitnÃ­ vizualizace nÃ¡vrhu vloÅ¾enÃ­ kandidÃ¡ta, kdy break rozdÄ›lujÃ­cÃ­ mezeru vytvÃ¡Å™el dva nÃ¡hledy mÃ­sto jednoho; `insertAfterIndex` se pÅ™iÅ™azuje jen mezerÃ¡m pÅ™ed customer stopy
> 
> **ZmÄ›ny v navigaci:**
> - `/planner` â†’ "PlÃ¡n dne" (slouÄeno PlÃ¡novÃ¡nÃ­ + MÅ¯j den)
> - `/today` â†’ pÅ™esmÄ›rovÃ¡nÃ­ na `/planner`
> - NavigaÄnÃ­ poloÅ¾ka "MÅ¯j den" odstranÄ›na

## PÅ™ehled

Tento dokument popisuje workflow a UI koncept pro klÃ­Äovou ÄÃ¡st aplikace Sazinka - plÃ¡novÃ¡nÃ­ pravidelnÃ½ch revizÃ­ a nÃ¡vÅ¡tÄ›v u zÃ¡kaznÃ­kÅ¯.

### CÃ­lovÃ¡ skupina
- DrobnÃ­ Å™emeslnÃ­ci (kominÃ­ci, plynaÅ™i, reviznÃ­ technici)
- PravidelnÃ© revize v intervalech 11-12 mÄ›sÃ­cÅ¯
- Jedna nebo vÃ­ce posÃ¡dek, jedno nebo vÃ­ce dep
- DispeÄerka + technici NEBO Å™emeslnÃ­k sÃ¡m

---

## ZÃ¡kladnÃ­ architektura

Aplikace mÃ¡ **3+1 vrstvy prÃ¡ce**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. CO SE BLÃÅ½Ã                                                  â”‚
â”‚     Automaticky spoÄÃ­tanÃ© "due window" (11-12 mÄ›sÃ­cÅ¯ od revize) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. DOMLUVIT                                                     â”‚
â”‚     Call workflow â†’ vybrat termÃ­n + ÄasovÃ© okno + sluÅ¾bu        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. NAPLÃNOVAT DEN                                               â”‚
â”‚     Route planner â†’ optimalizace poÅ™adÃ­ + ÄasovÃ¡ okna + depa    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. DEN VÃJEZDU (operativa)                                      â”‚
â”‚     RychlÃ© Ãºpravy, pÅ™esuny, export trasy                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Workflow krok za krokem

### 1. Po dokonÄenÃ­ revize â†’ automatickÃ¡ dalÅ¡Ã­ revize

KdyÅ¾ technik oznaÄÃ­ revizi jako "Hotovo":

1. UloÅ¾it `lastServiceAt` (datum dokonÄenÃ­)
2. SpoÄÃ­tat `nextDueFrom = lastServiceAt + 11 mÄ›sÃ­cÅ¯`
3. SpoÄÃ­tat `nextDueTo = lastServiceAt + 12 mÄ›sÃ­cÅ¯`
4. VytvoÅ™it novou revizi se stavem "ÄekÃ¡ na kontakt"

**UI - Detail zÃ¡kaznÃ­ka:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ  Jan NovÃ¡k                                    â”‚
â”‚ Revize plynovÃ©ho kotle                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PoslednÃ­ revize: 15.01.2026 (kotel)            â”‚
â”‚ DalÅ¡Ã­ revize:    10.12.2026 â€“ 15.01.2027       â”‚
â”‚ Stav:            â³ ÄŒekÃ¡ na kontakt             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ğŸ“ Zavolat]  [ğŸ“… Domluvit]                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 2. Fronta k obvolÃ¡nÃ­

HlavnÃ­ pracovnÃ­ obrazovka pro dispeÄerku i Å™emeslnÃ­ka-sÃ³listu.

**ZobrazenÃ­:**
- ZÃ¡kaznÃ­ci v oknÄ› 11-12 mÄ›sÃ­cÅ¯ od poslednÃ­ revize
- ZÃ¡kaznÃ­ci po termÃ­nu (prioritnÄ› nahoÅ™e)

**Filtry:**
- Oblast (mÄ›sto/PSÄŒ/region)
- Typ sluÅ¾by (kotel, komÃ­n, plyn...)
- Depo/posÃ¡dka
- Priorita
- "Nevolat dopoledne" a podobnÃ© preference

**Informace u kaÅ¾dÃ©ho zÃ¡kaznÃ­ka:**
1. Kde je zÃ¡kaznÃ­k (adresa + mini mapa / region)
2. Jak dlouho trvÃ¡ Ãºkon (servisnÃ­ Äas)
3. Stav kontaktu (naposledy volÃ¡no, poznÃ¡mka)

**UI - Fronta k obvolÃ¡nÃ­:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ Fronta k obvolÃ¡nÃ­                    [Filtr â–¾] [Oblast â–¾]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚ ğŸ”´ PO TERMÃNU (3)                                                   â”‚
â”‚ â”œâ”€â”€ Karel Svoboda    â”‚ Brno-stÅ™ed  â”‚ Kotel 45min â”‚ â˜ï¸ 3x neÃºspÄ›Å¡nÄ› â”‚
â”‚ â”œâ”€â”€ Marie DvoÅ™Ã¡kovÃ¡  â”‚ Brno-sever  â”‚ KomÃ­n 30min â”‚ â˜ï¸ NezvedÃ¡      â”‚
â”‚ â””â”€â”€ Petr ÄŒernÃ½       â”‚ Blansko     â”‚ Kotel 45min â”‚ â˜ï¸ NevolÃ¡no     â”‚
â”‚                                                                     â”‚
â”‚ ğŸŸ¡ TENTO TÃDEN (8)                                                  â”‚
â”‚ â”œâ”€â”€ Jana NovÃ¡kovÃ¡    â”‚ VyÅ¡kov      â”‚ Kotel 45min â”‚ â˜ï¸ NevolÃ¡no     â”‚
â”‚ â”œâ”€â”€ ...                                                             â”‚
â”‚                                                                     â”‚
â”‚ ğŸŸ¢ PÅ˜ÃÅ TÃ TÃDEN (12)                                                â”‚
â”‚ â””â”€â”€ ...                                                             â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Celkem: 23 zÃ¡kaznÃ­kÅ¯ k obvolÃ¡nÃ­                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Domluva nÃ¡vÅ¡tÄ›vy (klÃ­ÄovÃ¡ obrazovka)

**ZÃ¡sadnÃ­ princip:** PÅ™i domluvÄ› nesmÃ­Å¡ vybÃ­rat sloty naslepo. NabÃ­dka termÃ­nÅ¯ musÃ­ odrÃ¡Å¾et realitu trasy.

**UI - Dialog "Domluvit nÃ¡vÅ¡tÄ›vu":**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“… Domluvit nÃ¡vÅ¡tÄ›vu                                         [âœ•]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚ ZÃKAZNÃK                                                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Jan NovÃ¡k                                                       â”‚ â”‚
â”‚ â”‚ LesnÃ­ 123, Brno 61500                                          â”‚ â”‚
â”‚ â”‚ ğŸ“ +420 777 123 456                                             â”‚ â”‚
â”‚ â”‚ âš ï¸ PoznÃ¡mka: Parkovat za domem, zvonek nefunguje               â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ TYP ÃšKONU                           DÃ‰LKA                          â”‚
â”‚ [Revize kotle      â–¾]               [45 min â–¾]                     â”‚
â”‚                                                                     â”‚
â”‚ KDO POJEDE                          DEPO                           â”‚
â”‚ [Technik 1 - Petr  â–¾]               [Brno-stÅ™ed â–¾]                 â”‚
â”‚                                                                     â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚                                                                     â”‚
â”‚ VÃBÄšR DNE                                                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Po    Ãšt    St    ÄŒt    PÃ¡    So    Ne                        â”‚ â”‚
â”‚ â”‚  27    28    29    30    31     1     2                        â”‚ â”‚
â”‚ â”‚  [3]   [5]   [2]  [ğŸ”µ4]  [6]   [-]   [-]                       â”‚ â”‚
â”‚ â”‚                    â†‘ vybranÃ½ den                                â”‚ â”‚
â”‚ â”‚  (ÄÃ­sla = poÄet volnÃ½ch slotÅ¯)                                 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ DOPORUÄŒENÃ‰ SLOTY PRO 30.01.2026 (Multi-crew, Valhalla)             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸš PosÃ¡dka P1 (5 zastÃ¡vek, 78% dne)                            â”‚ â”‚
â”‚ â”‚ â”œâ”€ â­ 10:15 - 11:00  â”‚ 92%  â”‚ +8min â”‚ OK    â”‚ [Vybrat]        â”‚ â”‚
â”‚ â”‚ â”œâ”€    14:00 - 15:00  â”‚ 71%  â”‚ +22minâ”‚ TÄ›snÃ½ â”‚ [Vybrat]        â”‚ â”‚
â”‚ â”‚                                                                 â”‚ â”‚
â”‚ â”‚ ğŸš PosÃ¡dka P2 (3 zastÃ¡vky, 45% dne)                            â”‚ â”‚
â”‚ â”‚ â”œâ”€    10:30 - 11:30  â”‚ 85%  â”‚ +12minâ”‚ OK    â”‚ [Vybrat]        â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ NEBO VLASTNÃ ÄŒAS  (real-time validace, debounced 500ms)            â”‚
â”‚ [ÄŒasovÃ© okno: ___:___ - ___:___]                                   â”‚
â”‚ âŒ Slot se pÅ™ekrÃ½vÃ¡ s nÃ¡vÅ¡tÄ›vou DvoÅ™Ã¡kovÃ¡ (error)                  â”‚
â”‚ âš ï¸ PÅ™ed slotem je minimÃ¡lnÃ­ ÄasovÃ¡ rezerva (warning)               â”‚
â”‚ â†’ OdhadovanÃ½ pÅ™Ã­jezd: 10:03 | Rezerva: 12 min                     â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                              [ZruÅ¡it]  [âœ“ Domluvit nÃ¡vÅ¡tÄ›vu]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Algoritmus nabÃ­dky slotÅ¯ (v2 â€” multi-crew, Valhalla):**

Aplikace v pozadÃ­ (`sazinka.slots.suggest.v2`):
1. Pro **vÅ¡echny aktivnÃ­ posÃ¡dky** (nebo vybranou podmnoÅ¾inu) naÄte existujÃ­cÃ­ trasu + naplÃ¡novanÃ© revize
2. PomocÃ­ **Valhalla** spoÄÃ­tÃ¡ matice vzdÃ¡lenostÃ­/ÄasÅ¯ (reÃ¡lnÃ© souÅ™adnice zÃ¡kaznÃ­kÅ¯ z DB)
3. Pro kaÅ¾dou posÃ¡dku najde **optimÃ¡lnÃ­ inserÄnÃ­ pozice** (sdÃ­lenÃ¡ logika `calculate_insertion_positions`)
4. OhodnotÃ­ kaÅ¾dÃ½ slot **skÃ³rovacÃ­ funkcÃ­**:
   - 40% travel (delta_minutes) â€” menÅ¡Ã­ objÃ­Å¾Äka = lepÅ¡Ã­
   - 25% fit (slack_before + slack_after) â€” vÃ­ce rezervy = lepÅ¡Ã­
   - 20% preference â€” shoda s preferovanÃ½m Äasem zÃ¡kaznÃ­ka
   - 15% balance â€” vyrovnanÃ© vytÃ­Å¾enÃ­ posÃ¡dek
5. Status badge: **OK** (zelenÃ½), **TÄ›snÃ½** (Å¾lutÃ½, slack <15 min), **Konflikt** (ÄervenÃ½)

**Validace ruÄnÄ› zadanÃ©ho slotu** (`sazinka.slots.validate`):
- PÅ™ekryv s existujÃ­cÃ­ nÃ¡vÅ¡tÄ›vou (error)
- NedosaÅ¾itelnÃ½ Äas â€” cestovnÃ­ doba nestihne (error)
- Mimo pracovnÃ­ dobu (error)
- MinimÃ¡lnÃ­ rezerva <15 min (warning)
- PÅ™etÃ­Å¾enÃ½ den >90% (warning)
- Zasahuje do okna pauzy (warning)

Pokud validace vrÃ¡tÃ­ `feasible: false`, zobrazÃ­ se **warning box** s moÅ¾nostÃ­ "PÅ™esto naplÃ¡novat" nebo "Vybrat jinÃ½ slot".

---

### 4. PlÃ¡novÃ¡nÃ­ dne (dispeÄerskÃ½ pohled)

Zde se sklÃ¡dÃ¡ dennÃ­ plÃ¡n a Å™eÅ¡Ã­ multi-car a depa.

**UI - PlÃ¡novaÄ dne:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“… PlÃ¡n dne: 30.01.2026              [â—€ PÅ™edchozÃ­] [DalÅ¡Ã­ â–¶]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Technik 1 - Petr]  [Technik 2 - Jan]  [+ PÅ™idat posÃ¡dku]                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ZASTÃVKY (9)           â”‚                    MAPA                            â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ  Depo Brno       â”‚ â”‚  â”‚                                            â”‚   â”‚
â”‚ â”‚    Start 08:00     â”‚ â”‚  â”‚         ğŸ                                  â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚          â•²                                 â”‚   â”‚
â”‚ â”‚ 1. Jan NovÃ¡k       â”‚ â”‚  â”‚           â•²  â‘                             â”‚   â”‚
â”‚ â”‚    08:27 - 09:12   â”‚ â”‚  â”‚            â•²â”€â”€â—                            â”‚   â”‚
â”‚ â”‚    â±ï¸ 45min â”‚ ğŸ”’    â”‚ â”‚  â”‚               â•²                           â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚                â•²  â‘¡                       â”‚   â”‚
â”‚ â”‚ 2. Marie SvobodovÃ¡ â”‚ â”‚  â”‚                 â—â”€â”€â•²                       â”‚   â”‚
â”‚ â”‚    09:35 - 10:05   â”‚ â”‚  â”‚                      â•²  â‘¢                  â”‚   â”‚
â”‚ â”‚    â±ï¸ 30min        â”‚ â”‚  â”‚                       â—                    â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â”‚                      â•±                     â”‚   â”‚
â”‚ â”‚ 3. Petr ÄŒernÃ½      â”‚ â”‚  â”‚                    â•±                       â”‚   â”‚
â”‚ â”‚    10:28 - 11:13   â”‚ â”‚  â”‚                  ğŸ                         â”‚   â”‚
â”‚ â”‚    â±ï¸ 45min â”‚ âš ï¸    â”‚ â”‚  â”‚                                            â”‚   â”‚
â”‚ â”‚    Riziko zpoÅ¾dÄ›nÃ­ â”‚ â”‚  â”‚                                            â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚ â”‚ ...                â”‚ â”‚                                                    â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚  STATISTIKY                                       â”‚
â”‚ â”‚ ğŸ  Depo Brno       â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚    NÃ¡vrat ~16:30   â”‚ â”‚  â”‚ CelkovÃ¡ vzdÃ¡lenost:  87 km                 â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚ CelkovÃ½ Äas:         6h 45min              â”‚   â”‚
â”‚                        â”‚  â”‚ ServisnÃ­ Äas:        5h 15min              â”‚   â”‚
â”‚ [â†» Re-optimalizovat]   â”‚  â”‚ ÄŒas na cestÄ›:        1h 30min              â”‚   â”‚
â”‚ [+ PÅ™idat zastÃ¡vku]    â”‚  â”‚ Konflikty:           1 âš ï¸                   â”‚   â”‚
â”‚                        â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Interakce:**
- Drag & drop pro zmÄ›nu poÅ™adÃ­ zastÃ¡vek
- "Re-optimalizovat" tlaÄÃ­tko (zachovÃ¡ domluvenÃ¡ okna)
- "Zamknout poÅ™adÃ­" ğŸ”’ pro citlivÃ© zakÃ¡zky
- PÅ™etÃ¡hnout zakÃ¡zku mezi auty (multi-car reÅ¾im)

**VarovÃ¡nÃ­ (musÃ­ bÃ½t velmi viditelnÃ¡):**
- ğŸ”´ ÄŒasovÃ© okno nestÃ­hÃ¡ vyjÃ­t
- ğŸŸ¡ Riziko zpoÅ¾dÄ›nÃ­ (trasa natÄ›sno)
- ğŸŸ  PÅ™ejezd pÅ™Ã­liÅ¡ dlouhÃ½
- âš« PÅ™ekroÄenÃ­ pracovnÃ­ doby

---

### 5. Den vÃ½jezdu (operativa + export)

Bez mobilnÃ­ aplikace potÅ™ebuje technik jednoduchÃ© webovÃ© rozhranÃ­.

**UI - MÅ¯j dneÅ¡nÃ­ plÃ¡n:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“± MÅ¯j plÃ¡n na 30.01.2026                        [ğŸ”„] [ğŸ“¤ Export]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â‘  Jan NovÃ¡k                                    08:27 - 09:12   â”‚ â”‚
â”‚ â”‚    LesnÃ­ 123, Brno                                              â”‚ â”‚
â”‚ â”‚    ğŸ“ +420 777 123 456                                          â”‚ â”‚
â”‚ â”‚    Revize kotle â”‚ 45 min                                        â”‚ â”‚
â”‚ â”‚    âš ï¸ Parkovat za domem                                         â”‚ â”‚
â”‚ â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚    [ğŸ—ºï¸ Navigovat]  [ğŸ“ Volat]  [âœ“ Hotovo]  [âœ• NezastiÅ¾en]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â‘¡ Marie SvobodovÃ¡                              09:35 - 10:05   â”‚ â”‚
â”‚ â”‚    HlavnÃ­ 45, Brno-sever                                        â”‚ â”‚
â”‚ â”‚    ğŸ“ +420 608 234 567                                          â”‚ â”‚
â”‚ â”‚    VymetÃ¡nÃ­ komÃ­nu â”‚ 30 min                                     â”‚ â”‚
â”‚ â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚
â”‚ â”‚    [ğŸ—ºï¸ Navigovat]  [ğŸ“ Volat]  [âœ“ Hotovo]  [âœ• NezastiÅ¾en]      â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                     â”‚
â”‚ ... dalÅ¡Ã­ zastÃ¡vky ...                                              â”‚
â”‚                                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Hotovo: 0/9  â”‚  ZbÃ½vÃ¡: ~6h 45min  â”‚  DalÅ¡Ã­: Jan NovÃ¡k za 15 min   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Exporty:**
- "OtevÅ™Ã­t trasu v Google Maps" (waypoints, pÅ™i limitu rozdÄ›lit)
- PDF "dennÃ­ plÃ¡n" (adresa, okno, poznÃ¡mky, telefon)
- CSV export (pro vlastnÃ­ navigaci / archiv)

---

## Role a reÅ¾imy pouÅ¾itÃ­

> **Autentizace:** PÅ™Ã­stup k aplikaci vyÅ¾aduje pÅ™ihlÃ¡Å¡enÃ­ (JWT). Role jsou vynuceny na backendu i frontendu. Viz `PROJECT_MULTIUSER.MD`.

### Role

| Role | PÅ™Ã­stup ke strÃ¡nkÃ¡m | Popis |
|------|---------------------|-------|
| **Admin** | VÅ¡e vÄetnÄ› Admin panelu | SprÃ¡vce systÃ©mu |
| **Customer** | VÅ¡e kromÄ› Admin (vÄetnÄ› NastavenÃ­) | Majitel firmy, mÅ¯Å¾e vytvÃ¡Å™et pracovnÃ­ky |
| **Worker** | VÅ¡e kromÄ› Admin a NastavenÃ­ | ZamÄ›stnanec, vidÃ­ data svÃ©ho zÃ¡kaznÃ­ka |

### ReÅ¾im A: DispeÄerka + 1-N aut (Customer + Workers)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   DispeÄerka    â”‚     â”‚   Technik 1     â”‚     â”‚   Technik 2     â”‚
â”‚   (Customer)    â”‚     â”‚   (Worker)      â”‚     â”‚   (Worker)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Fronta        â”‚     â”‚ â€¢ MÅ¯j plÃ¡n      â”‚     â”‚ â€¢ MÅ¯j plÃ¡n      â”‚
â”‚ â€¢ Domluva       â”‚â”€â”€â”€â”€â–¶â”‚ â€¢ Status update â”‚     â”‚ â€¢ Status update â”‚
â”‚ â€¢ PlÃ¡novÃ¡nÃ­     â”‚     â”‚ â€¢ Export        â”‚     â”‚ â€¢ Export        â”‚
â”‚ â€¢ PÅ™ehledy      â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ NastavenÃ­     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ReÅ¾im B: Å˜emeslnÃ­k sÃ¡m (Customer bez Workers)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Å˜emeslnÃ­k (Customer, vÅ¡e sÃ¡m)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Fronta + mini plÃ¡novÃ¡nÃ­ v jednom  â”‚
â”‚ â€¢ "MÅ¯j plÃ¡n" jako vÃ½chozÃ­ homepage  â”‚
â”‚ â€¢ Domluva s automatickÃ½mi sloty     â”‚
â”‚ â€¢ NastavenÃ­                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## KlÃ­ÄovÃ© datovÃ© entity

| Entita | Popis | KlÃ­ÄovÃ© atributy |
|--------|-------|------------------|
| Customer | ZÃ¡kaznÃ­k | adresa, GPS, kontakt, poznÃ¡mky |
| Device | ZaÅ™Ã­zenÃ­ k revizi | typ, revision_interval_months |
| Revision | PlÃ¡novanÃ¡/provedenÃ¡ revize | due_date, scheduled_date, time_window, status |
| Crew | PosÃ¡dka/technik | depot_id, kapacita, pracovnÃ­ doba |
| Depot | VÃ½chozÃ­ mÃ­sto | adresa, GPS |
| Route | DennÃ­ plÃ¡n | datum, crew_id, zastÃ¡vky[], statistiky |

---

## Stavy revize (lifecycle)

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   VYTVOÅ˜ENO  â”‚
                    â”‚ (automaticky)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ODLOÅ½ENO   â”‚â—„â”€â”€â”€â”‚   ÄŒEKÃ NA    â”‚
â”‚              â”‚    â”‚   KONTAKT    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚ zÃ¡kaznÃ­k kontaktovÃ¡n
       â”‚                   â–¼
       â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  DOMLUVENO   â”‚
                   â”‚ (mÃ¡ termÃ­n)  â”‚
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ pÅ™iÅ™azeno do trasy
                          â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ NAPLÃNOVÃNO  â”‚
                   â”‚ (v trase)    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â–¼             â–¼             â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ HOTOVO   â”‚  â”‚NEZASTIÅ½ENâ”‚  â”‚ ZRUÅ ENO  â”‚
     â”‚          â”‚  â”‚          â”‚  â”‚          â”‚
     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”‚ automaticky
          â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  DALÅ Ã   â”‚
     â”‚ REVIZE   â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## DvÄ› UX vÄ›ci, kterÃ© udÄ›lajÃ­ nejvÄ›tÅ¡Ã­ rozdÃ­l

### 1. NabÃ­dka slotÅ¯ pÅ™i domluvÄ›
Ne "vyberte si datum a Äas naslepo", ale inteligentnÃ­ nÃ¡vrhy na zÃ¡kladÄ› aktuÃ¡lnÃ­ trasy.

### 2. Jedno kliknutÃ­: z domluvy do plÃ¡nu
A hned vidÄ›t dopad na trasu (vzdÃ¡lenost, Äas, konflikty).

---

## PlÃ¡n integrace UI podle workflow

CÃ­l: UÅ¾ivatel nesmÃ­ "pÅ™eskakovat" mezi izolovanÃ½mi strÃ¡nkami. KaÅ¾dÃ¡ obrazovka musÃ­ nabÃ­dnout jasnÃ½ dalÅ¡Ã­ krok a kontext.

### GlobÃ¡lnÃ­ pravidla navigace
- VÅ¾dy viditelnÃ© CTA pro dalÅ¡Ã­ krok workflow (napravo nahoÅ™e / v detail panelu).
- KaÅ¾dÃ¡ revize/zÃ¡kaznÃ­k mÃ¡ dostupnÃ© akce: `Detail`, `Domluvit`, `NaplÃ¡novat`, `OznaÄit hotovo` podle stavu.
- ZobrazenÃ­ kontextu: u kaÅ¾dÃ© revize vÅ¾dy zobrazit zÃ¡kaznÃ­ka, adresu, termÃ­n a stav.

### StrÃ¡nky a jejich propojenÃ­ (MVP plÃ¡n)
1. Dashboard
   - CTA: "Fronta k obvolÃ¡nÃ­" (primÃ¡rnÃ­), "PlÃ¡novÃ¡nÃ­ dne" (sekundÃ¡rnÃ­), "MÅ¯j den".
   - Widgety "Po termÃ­nu" a "Tento tÃ½den" musÃ­ bÃ½t klikatelnÃ© â†’ filtr na frontu nebo kalendÃ¡Å™.

2. Fronta k obvolÃ¡nÃ­ (`/queue`)
   - Akce "NaplÃ¡novat" po uloÅ¾enÃ­ pÅ™esmÄ›ruje do PlÃ¡novaÄe na vybranÃ½ den.
   - PÅ™idat proklik na `Detail zÃ¡kaznÃ­ka` a `Detail revize`.
   - V kartÄ› ukÃ¡zat poslednÃ­ komunikaci a poznÃ¡mku (z timeline).

3. KalendÃ¡Å™ (`/calendar`)
   - Klik na revizi vede na `Detail revize` (ne pouze seznam).
   - V detail panelu CTA: "OtevÅ™Ã­t v plÃ¡novaÄi" + "Domluvit" (pokud nemÃ¡ termÃ­n).
   - PÅ™epÃ­naÄ TermÃ­ny/NaplÃ¡novanÃ© zachovat, ale doplnit legendu pro stav workflow.

4. PlÃ¡novaÄ (`/planner`)
   - V seznamu "NaplÃ¡novanÃ©" zobrazit jmÃ©no zÃ¡kaznÃ­ka + adresu + ÄasovÃ© okno.
   - Klik na poloÅ¾ku â†’ detail revize (nebo side panel).
   - TlaÄÃ­tko "PÅ™idat z fronty" (kontextovÃ½ filtr na datum).

5. Detail revize (novÃ½ cÃ­lovÃ½ kontext)
   - CentrÃ¡lnÃ­ hub: status, termÃ­n, poznÃ¡mky, akce podle stavu.
   - Odkazy: zÃ¡kaznÃ­k, komunikace, nÃ¡vÅ¡tÄ›vy, plÃ¡n dne.

#### Detail revize - struktura strÃ¡nky (workflow hub)

**CÃ­l:** Jeden pohled pro vÅ¡echny kroky workflow. UÅ¾ivatel vidÃ­ kontext + dalÅ¡Ã­ akci bez hledÃ¡nÃ­.

**1) Sticky header**
- NÃ¡zev: `Revize - [typ zaÅ™Ã­zenÃ­]`
- Status badge: `ÄŒekÃ¡ na kontakt / Domluveno / NaplÃ¡novÃ¡no / Hotovo / ZruÅ¡eno`
- KlÃ­ÄovÃ© info: `TermÃ­n`, `ÄŒasovÃ© okno`, `DÃ©lka`, `Technik/posÃ¡dka`
- PrimÃ¡rnÃ­ CTA (context-aware):
  - ÄŒekÃ¡ na kontakt â†’ `Domluvit termÃ­n`
  - Domluveno â†’ `OtevÅ™Ã­t v plÃ¡novaÄi (den)`
  - NaplÃ¡novÃ¡no â†’ `OtevÅ™Ã­t v plÃ¡novaÄi (den)`
  - Hotovo â†’ `Zobrazit vÃ½sledek`
- SekundÃ¡rnÃ­ akce (menu): `PÅ™eplÃ¡novat`, `OdloÅ¾it`, `ZruÅ¡it`

**2) Kontekt zÃ¡kaznÃ­ka (card)**
- JmÃ©no, adresa, poznÃ¡mka
- Kontakty: `ğŸ“ Zavolat`, `âœ‰ï¸ Email`
- CTA: `OtevÅ™Ã­t zÃ¡kaznÃ­ka`
- Mini mapa (pokud existuje)

**3) Detail revize (card)**
- ZaÅ™Ã­zenÃ­: typ, nÃ¡zev, interval, poslednÃ­ revize
- TermÃ­n: datum + ÄasovÃ© okno + dÃ©lka
- PÅ™iÅ™azenÃ­: technik/posÃ¡dka/depo (pokud existuje)
- CTA: `OtevÅ™Ã­t zaÅ™Ã­zenÃ­`

**4) Workflow panel (pravÃ½ sloupec / side panel)**
- KontextovÃ© akce dle stavu:
  - ÄŒekÃ¡ na kontakt: `Domluvit`, `OdloÅ¾it`, `Zavolat`
  - Domluveno: `PÅ™eplÃ¡novat`, `OtevÅ™Ã­t v plÃ¡novaÄi`, `ZruÅ¡it`
  - NaplÃ¡novÃ¡no: `OtevÅ™Ã­t v plÃ¡novaÄi`, `PÅ™esun v trase` (pokud existuje)
  - Hotovo: `Zobrazit vÃ½sledek`, `VytvoÅ™it dalÅ¡Ã­ revizi` (pokud se dÄ›lÃ¡ ruÄnÄ›)
- Text "DalÅ¡Ã­ krok": napÅ™. `DalÅ¡Ã­ krok: naplÃ¡novat den`

**5) Historie a komunikace (timeline)**
- Komunikace (hovory, emaily, poznÃ¡mky)
- NÃ¡vÅ¡tÄ›vy (visit log)
- RychlÃ© pÅ™idÃ¡nÃ­ komunikace

**6) Operativa (volitelnÃ©)**
- `Tisk / PDF / Export`
- `Navigovat` (single-stop, pro technika)

#### Detail revize - wireframe (ASCII)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Revize - Plynovy kotel          [STATUS: DOMLUVENO]   [Domluvit termÃ­n]    â”‚
â”‚ TermÃ­n: 30.01.2026  |  Okno: 10:00-11:00  |  DÃ©lka: 45 min  |  Technik: A  â”‚
â”‚ [PÅ™eplÃ¡novat] [OdloÅ¾it] [ZruÅ¡it]                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZAKAZNIK                                  â”‚  â”‚ WORKFLOW                     â”‚
â”‚ Jan Novak                                 â”‚  â”‚ DalÅ¡Ã­ krok: naplÃ¡novat den   â”‚
â”‚ Lesni 123, Brno                           â”‚  â”‚                             â”‚
â”‚ Pozn.: Parkovat za domem                  â”‚  â”‚ [OtevÅ™Ã­t v plÃ¡novaÄi (den)]  â”‚
â”‚ [ğŸ“ Zavolat] [âœ‰ï¸ Email] [Detail zÃ¡kaznÃ­ka]â”‚  â”‚ [PÅ™eplÃ¡novat] [ZruÅ¡it]        â”‚
â”‚ [Mini mapa]                               â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ REVIZE                                    â”‚  â”‚ HISTORIE / KOMUNIKACE        â”‚
â”‚ ZaÅ™Ã­zenÃ­: Kotel ABC-123                   â”‚  â”‚ - 20.01: VolÃ¡no, nezastiÅ¾en  â”‚
â”‚ Interval: 12 mÄ›sÃ­cÅ¯                       â”‚  â”‚ - 25.01: Email o termÃ­nu     â”‚
â”‚ PoslednÃ­ revize: 15.01.2026               â”‚  â”‚ [PÅ™idat zÃ¡znam]               â”‚
â”‚ [Detail zaÅ™Ã­zenÃ­]                         â”‚  â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

6. ~~MÅ¯j den (`/today`)~~ â†’ **SLOUÄŒENO DO PLÃN DNE (`/planner`)**
   - `/today` nynÃ­ pÅ™esmÄ›rovÃ¡vÃ¡ na `/planner`
   - VÅ¡echny funkce (navigace, volÃ¡nÃ­, hotovo) jsou v PlÃ¡n dne

### MinimÃ¡lnÃ­ integraÄnÃ­ checklist âœ… COMPLETE
- [x] ZavÃ©st `Detail revize` jako primÃ¡rnÃ­ uzel workflow âœ…
- [x] PÅ™idat prokliky mezi Fronta â†’ Detail â†’ PlÃ¡n dne âœ…
- [x] VÅ¡echny seznamy revizÃ­ zobrazujÃ­ zÃ¡kaznÃ­ka a akci âœ…
- [x] Dashboard a KalendÃ¡Å™ majÃ­ pÅ™Ã­mÃ½ vstup do fronty/planovÃ¡nÃ­ âœ…
- [x] Po naplÃ¡novÃ¡nÃ­ automatickÃ½ nÃ¡vrat do kontextu (plÃ¡n dne) âœ…
- [x] SlouÄit PlÃ¡novÃ¡nÃ­ + MÅ¯j den do jednÃ© strÃ¡nky "PlÃ¡n dne" âœ…

### Tvorba dennÃ­ trasy z PlÃ¡novacÃ­ho inboxu

**CÃ­l:** UÅ¾ivatel vytvÃ¡Å™Ã­ dennÃ­ trasu pÅ™Ã­mo na strÃ¡nce Fronta (PlÃ¡novacÃ­ inbox), aniÅ¾ by musel pÅ™echÃ¡zet na strÃ¡nku PlÃ¡n dne. VybÃ­rÃ¡ zÃ¡kaznÃ­ky ze seznamu, pÅ™idÃ¡vÃ¡ je do trasy, optimalizuje a uklÃ¡dÃ¡ â€” vÅ¡e na jednÃ© obrazovce.

**StrÃ¡nka:** `/queue` â€” PlÃ¡novacÃ­ inbox (tÅ™Ã­sloupcovÃ½ layout)

#### Workflow tvorby trasy

1. UÅ¾ivatel vybere datum, posÃ¡dku a depo v header baru
2. UÅ¾ivatel prochÃ¡zÃ­ seznam kandidÃ¡tÅ¯ (levÃ½ panel)
3. KandidÃ¡ty pÅ™idÃ¡vÃ¡ do trasy buÄ:
   - JednotlivÄ›: klik na kandidÃ¡ta â†’ detail (pravÃ½ panel) â†’ tlaÄÃ­tko "PÅ™idat do trasy"
   - HromadnÄ›: zaÅ¡krtne checkboxy â†’ tlaÄÃ­tko "PÅ™idat vybranÃ© do trasy"
4. PÅ™idanÃ­ kandidÃ¡ti se zobrazÃ­ ve stÅ™ednÃ­m panelu pod mapou jako seznam zastÃ¡vek
5. Mapa prÅ¯bÄ›Å¾nÄ› zobrazuje zastÃ¡vky a propojenÃ­
6. UÅ¾ivatel klikne "Optimalizovat trasu" â†’ VRP solver pÅ™epoÄÃ­tÃ¡ poÅ™adÃ­ a Äasy
7. Trasa se **automaticky uklÃ¡dÃ¡** prÅ¯bÄ›Å¾nÄ› (auto-save s debounce 1,5 s) â€” uÅ¾ivatel nemusÃ­ nic uklÃ¡dat ruÄnÄ›

#### LevÃ½ panel â€” Seznam kandidÃ¡tÅ¯

- U kaÅ¾dÃ©ho kandidÃ¡ta je checkbox pro hromadnÃ½ vÃ½bÄ›r
- KandidÃ¡ti, kteÅ™Ã­ jsou jiÅ¾ v trase, majÃ­ vizuÃ¡lnÃ­ oznaÄenÃ­ (barevnÃ½ prouÅ¾ek vlevo)
- Pod segmentovÃ½mi zÃ¡loÅ¾kami je tlaÄÃ­tko "PÅ™idat vybranÃ© do trasy" (aktivnÃ­, kdyÅ¾ jsou zaÅ¡krtnutÃ© checkboxy)
- KlÃ¡vesovÃ¡ zkratka `A` â€” pÅ™idat aktuÃ¡lnÄ› vybranÃ©ho kandidÃ¡ta do trasy

#### StÅ™ednÃ­ panel â€” Mapa + ZastÃ¡vky v trase

- HornÃ­ ÄÃ¡st: mapa se zastÃ¡vkami a trasou
- SpodnÃ­ ÄÃ¡st: kompaktnÃ­ seznam zastÃ¡vek v trase:
  - PoÅ™adovÃ© ÄÃ­slo, jmÃ©no zÃ¡kaznÃ­ka, adresa, ETAâ€“ETD, tlaÄÃ­tko âœ• (odebrat)
  - SouhrnnÃ© metriky: vzdÃ¡lenost, Äas, poÄet zastÃ¡vek, zatÃ­Å¾enÃ­ dne (%)
- AkÄnÃ­ tlaÄÃ­tka: Optimalizovat trasu, VyÄistit
- **Auto-save:** Trasa se automaticky uklÃ¡dÃ¡ 1,5 s po poslednÃ­ zmÄ›nÄ› (pÅ™idÃ¡nÃ­, odebrÃ¡nÃ­, optimalizace). Status bar v hlaviÄce ukazuje:
  - `â— NeuloÅ¾enÃ© zmÄ›ny` â€” zmÄ›na ÄekÃ¡ na uloÅ¾enÃ­ (debounce)
  - `âŸ³ UklÃ¡dÃ¡m...` â€” probÃ­hÃ¡ uklÃ¡dÃ¡nÃ­
  - `âœ“ UloÅ¾eno prÃ¡vÄ› teÄ / pÅ™ed N min` â€” ÃºspÄ›Å¡nÄ› uloÅ¾eno
  - `âš ï¸ NepodaÅ™ilo se uloÅ¾it [Zkusit znovu]` â€” chyba s moÅ¾nostÃ­ retry
- PrÃ¡zdnÃ½ stav: "ZatÃ­m Å¾Ã¡dnÃ© zastÃ¡vky v trase. Vyberte kandidÃ¡ty ze seznamu."

#### PravÃ½ panel â€” Detail kandidÃ¡ta

- Pod slot suggestions pÅ™idÃ¡no tlaÄÃ­tko "PÅ™idat do trasy"
- Pokud je kandidÃ¡t jiÅ¾ v trase, mÃ­sto "PÅ™idat" se zobrazÃ­ "Odebrat z trasy"
- KlÃ¡vesovÃ¡ zkratka `R` â€” odebrat aktuÃ¡lnÄ› vybranÃ©ho z trasy

#### Wireframe

```
PLÃNOVACÃ INBOX â€” TVORBA TRASY
=============================================================================
Den: 07.02.2026  PosÃ¡dka: Petr  Depo: Brno-stÅ™ed  [Route-aware: ON]
=============================================================================

KANDIDÃTI (levÃ½ panel)        MAPA + TRASA (stÅ™ed)         DETAIL (pravÃ½)
+---------------------------+ +------------------------+ +------------------+
| [x] Po termÃ­nu  TÃ½den ... | |                        | | Jan NovÃ¡k        |
|                           | |    [MAPA S TRASOU]      | | Kotel 45min      |
| [ ] Karel S.  Brno  +2min | |    1â”€â”€2â”€â”€3â”€â”€Depo        | | LesnÃ­ 123, Brno  |
| [x] Marie D.  Brno  +5min | |                        | |                  |
| [ ] Petr ÄŒ.   Blank +8min | +------------------------+ | Slot suggestions:|
| [x] Jana N.   VyÅ¡k +12min | | ZASTÃVKY V TRASE (3)   | | 09:15 +2min  OK  |
| â–Œ  Anna K. (v trase)      | | 1. Karel S. 08:30-09:15| | 10:45 +5min  OK  |
|                           | | 2. Anna K.  09:45-10:15| | 14:00 +8min Tight|
| [PÅ™idat vybranÃ© do trasy] | | 3. JiÅ™Ã­ M.  10:45-11:30| |                  |
|                           | |                    [âœ•]  | | [PÅ˜IDAT DO TRASY]|
|                           | | VzdÃ¡l: 45km  ÄŒas: 3h   | | [OdloÅ¾it]        |
|                           | | ZatÃ­Å¾enÃ­: 62%           | | [Detail zÃ¡kaznÃ­ka]|
|                           | |                        | |                  |
|                           | | [Optimalizovat][VyÄistit]| | kbd: A pÅ™idat    |
|                           | | âœ“ UloÅ¾eno prÃ¡vÄ› teÄ     | |      R odebrat   |
+---------------------------+ +------------------------+ +------------------+
```

#### KlÃ¡vesovÃ© zkratky (rozÅ¡Ã­Å™enÃ­)

| KlÃ¡vesa | Akce |
|---------|------|
| `A` | PÅ™idat vybranÃ©ho kandidÃ¡ta do trasy (best slot) |
| `R` | Odebrat vybranÃ©ho kandidÃ¡ta z trasy |
| `Shift+A` | PÅ™idat vÅ¡echny zaÅ¡krtnutÃ© do trasy |

---

## RozhodnutÃ­ a mapovÃ¡nÃ­ na existujÃ­cÃ­ model

### 1. Entity mapping (ROZHODNUTO)

| NavrÅ¾enÃ¡ entita | ExistujÃ­cÃ­ entita | PoznÃ¡mka |
|-----------------|-------------------|----------|
| Asset | `Device` | âœ… PÅ™Ã­mÃ© mapovÃ¡nÃ­ |
| ServiceCycle | Logika v `Device` + `Revision` | NenÃ­ potÅ™eba novÃ¡ tabulka |
| Job | `Revision` | âœ… Revision = co je potÅ™eba udÄ›lat |
| Appointment | `Revision` | âœ… Revision = kdy se to mÃ¡ udÄ›lat |
| Visit | `Visit` | âœ… HistorickÃ½ zÃ¡znam provedenÃ­ |

**KlÃ­ÄovÃ© rozhodnutÃ­:** NezavÃ¡dÄ›t novÃ© entity Job/Appointment. `Revision` pokrÃ½vÃ¡ obojÃ­:
- `scheduled_date IS NULL` â†’ backlog / ÄekÃ¡ na kontakt
- `scheduled_date IS NOT NULL` â†’ appointment / domluveno

### 2. Stavy revize (ROZHODNUTO)

**Zachovat existujÃ­cÃ­ enum, pÅ™idat odvozenÃ© stavy logikou:**

| UX stav | MapovÃ¡nÃ­ | Implementace |
|---------|----------|--------------|
| PlÃ¡novanÃ¡ (dÅ™Ã­ve NadchÃ¡zejÃ­cÃ­) | `upcoming` | `status='upcoming' AND scheduled_date IS NULL` |
| Domluveno | `scheduled` | `status='scheduled'` (mÃ¡ termÃ­n, nepotvrzeno) |
| Potvrzeno | `confirmed` | `status='confirmed'` |
| NaplÃ¡novÃ¡no v trase | `confirmed` | + `route_order IS NOT NULL` |
| DokonÄeno | `completed` | `status='completed'` - **pouze dokonÄenÃ© revize zaklÃ¡dajÃ­ vÃ½poÄet "po termÃ­nu"** |
| OdloÅ¾eno | `upcoming` | + novÃ© pole `snooze_until` |
| ZruÅ¡eno | `cancelled` | `status='cancelled'` |

> **ZmÄ›na v0.16.0:** Stav "NadchÃ¡zejÃ­cÃ­" pÅ™ejmenovÃ¡n na "PlÃ¡novanÃ¡" (lÃ©pe vystihuje vÃ½znam).
> Pouze dokonÄenÃ© revize (`status='completed'`) se pouÅ¾Ã­vajÃ­ pro vÃ½poÄet zpoÅ¾dÄ›nÃ­.
> ZpoÅ¾dÄ›nÃ­ = (last_completed_at + interval_months) < today.
> Pro zaÅ™Ã­zenÃ­ bez provedenÃ© revize se pouÅ¾ije installation_date jako zÃ¡klad.

**NovÃ¡ pole pro Revision (schema change):**
```sql
ALTER TABLE revisions ADD COLUMN snooze_until DATE;
ALTER TABLE revisions ADD COLUMN snooze_reason VARCHAR(255);
ALTER TABLE revisions ADD COLUMN assigned_crew_id UUID REFERENCES crews(id);
ALTER TABLE revisions ADD COLUMN route_order INTEGER;
```

### 3. Algoritmus nabÃ­dky slotÅ¯ (ROZHODNUTO)

**Insertion Heuristic s Valhalla cache:**

```
1. Pro zvolenÃ½ den + posÃ¡dku naÄti existujÃ­cÃ­ trasu:
   Depot â†’ A â†’ B â†’ C â†’ Depot

2. Pro novÃ©ho zÃ¡kaznÃ­ka X zkus vloÅ¾it mezi kaÅ¾dou dvojici:
   - mezi Depot/A, A/B, B/C, C/Depot

3. SpoÄÃ­tej delta travel time:
   Î” = t(A,X) + t(X,B) - t(A,B)

4. Simuluj forward pass pro feasibility:
   - arrival/departure times
   - ovÄ›Å™ ÄasovÃ¡ okna (hard constraint)

5. SkÃ³re kandidÃ¡ta:
   - 60% Î” travel time (niÅ¾Å¡Ã­ = lepÅ¡Ã­)
   - 25% slack (vÃ­ce = lepÅ¡Ã­)
   - 15% area coherence (volitelnÃ©)

6. Vyber top 3-5 slotÅ¯, diverzifikuj Äasy
```

**VÃ½kon s Valhalla:**
- Cache travel times mezi existujÃ­cÃ­mi body dne
- Pro novÃ½ bod X dopoÄÃ­tat pouze: `t(X, vÅ¡ichni)` a `t(vÅ¡ichni, X)`

### 4. Multi-crew a multi-depot (ROZHODNUTO)

**MVP:**
- `Crew.home_depot_id` = default start/end
- `Crew.preferred_area` = seznam PSÄŒ prefixÅ¯ / okresÅ¯
- RuÄnÃ­ pÅ™iÅ™azenÃ­ + jednoduchÃ© regiony
- UI: zobrazit "Day load" per posÃ¡dka

**V2:**
- Clustering zakÃ¡zek do N clusterÅ¯ (N = poÄet posÃ¡dek)
- Auto-balance load mezi posÃ¡dkami
- `RoutePlan.start_depot_id`, `RoutePlan.end_depot_id` pro pÅ™epsÃ¡nÃ­

### 5. Export Google Maps (ROZHODNUTO)

**Segmentace trasy:**
- RozdÄ›lit na segmenty po 8-10 zastÃ¡vkÃ¡ch
- Generovat 2-5 odkazÅ¯: "Trasa 1/4", "Trasa 2/4"...
- KaÅ¾dÃ½ odkaz otevÅ™e Google Maps s ÄÃ¡stÃ­ dne

**Fallback:**
- PDF / tisk (seznam adres + tel + okna)
- KML/GPX export pro jinÃ© navigace
- "Navigovat" tlaÄÃ­tko per zastÃ¡vka (jednobodovÄ›, bez limitÅ¯)

---

## MVP ImplementaÄnÃ­ plÃ¡n

### FÃ¡ze 1: ZÃ¡kladnÃ­ infrastruktura (1-2 tÃ½dny)

**DB zmÄ›ny:**
```sql
-- RozÅ¡Ã­Å™enÃ­ revisions
ALTER TABLE revisions ADD COLUMN snooze_until DATE;
ALTER TABLE revisions ADD COLUMN snooze_reason VARCHAR(255);
ALTER TABLE revisions ADD COLUMN assigned_crew_id UUID;
ALTER TABLE revisions ADD COLUMN route_order INTEGER;

-- NovÃ¡ tabulka crews (pokud neexistuje)
CREATE TABLE crews (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id),
  name VARCHAR(100) NOT NULL,
  home_depot_id UUID REFERENCES depots(id),
  preferred_areas TEXT[], -- PSÄŒ prefixy
  working_hours_start TIME DEFAULT '08:00',
  working_hours_end TIME DEFAULT '17:00',
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

**Backend:**
- [ ] Migration pro novÃ¡ pole
- [ ] CRUD pro Crew entity
- [ ] Endpoint: `revision.queue` - fronta k obvolÃ¡nÃ­

### FÃ¡ze 2: Fronta k obvolÃ¡nÃ­ (1 tÃ½den)

**Endpoint:** `GET /api/revisions/queue`
```typescript
interface QueueFilters {
  status: 'overdue' | 'due_soon' | 'upcoming';
  area?: string;      // PSÄŒ prefix
  deviceType?: string;
  crewId?: string;
}

interface QueueItem {
  revision: Revision;
  customer: Customer;
  device: Device;
  daysUntilDue: number;
  lastContactAt?: Date;
  contactAttempts: number;
}
```

**UI komponenty:**
- [ ] `CallQueue` - seznam s filtry
- [ ] `QueueItem` - karta zÃ¡kaznÃ­ka
- [ ] Quick actions: Zavolat, OdloÅ¾it, Domluvit

### FÃ¡ze 3: Domluva revize (1-2 tÃ½dny)

**Endpoint:** `POST /api/revisions/{id}/schedule`
```typescript
interface ScheduleRequest {
  scheduledDate: string;
  timeWindowStart: string;
  timeWindowEnd: string;
  serviceDuration: number;
  crewId?: string;
  notes?: string;
}
```

**UI komponenty:**
- [ ] `ScheduleRevisionDialog` - modal pro domluvu
- [ ] KalendÃ¡Å™ s poÄtem volnÃ½ch slotÅ¯ per den
- [ ] Seznam ÄasovÃ½ch oken (zatÃ­m bez smart slotÅ¯)

### FÃ¡ze 4: PlÃ¡n dne - zÃ¡kladnÃ­ (1-2 tÃ½dny)

**Endpoint:** `GET /api/routes/{date}/{crewId}`
```typescript
interface DayPlan {
  date: string;
  crew: Crew;
  stops: PlannedStop[];
  totalDistance: number;
  totalDuration: number;
  warnings: RouteWarning[];
}
```

**UI komponenty:**
- [ ] `DayPlanner` - dispeÄerskÃ½ pohled
- [ ] Drag & drop poÅ™adÃ­ zastÃ¡vek
- [ ] Mapa s trasou (existujÃ­cÃ­)
- [ ] ZÃ¡kladnÃ­ varovÃ¡nÃ­ konfliktÅ¯

### FÃ¡ze 5: MÅ¯j dneÅ¡nÃ­ plÃ¡n (1 tÃ½den)

**UI komponenty:**
- [ ] `TechnicianDayView` - mobilnÃ­-friendly seznam
- [ ] Per-stop akce: Navigovat, Volat, Hotovo, NezastiÅ¾en
- [ ] Export: segmentovanÃ© Google Maps linky
- [ ] PDF export

### FÃ¡ze 6 (V2): Smart sloty (2-3 tÃ½dny)

**Backend:**
- [ ] Insertion heuristic algoritmus
- [ ] Valhalla matrix cache per den/posÃ¡dka
- [ ] Endpoint: `GET /api/slots/suggest`

**UI:**
- [ ] ZobrazenÃ­ doporuÄenÃ½ch slotÅ¯ v `ScheduleRevisionDialog`
- [ ] Vizualizace dopadu na trasu (+X min)

---

## API Endpointy (pÅ™ehled)

| Endpoint | Metoda | Popis |
|----------|--------|-------|
| `/api/revisions/queue` | GET | Fronta k obvolÃ¡nÃ­ |
| `/api/revisions/{id}/schedule` | POST | Domluvit termÃ­n |
| `/api/revisions/{id}/snooze` | POST | OdloÅ¾it revizi |
| `/api/crews` | CRUD | SprÃ¡va posÃ¡dek |
| `/api/routes/{date}` | GET | PlÃ¡n dne (vÅ¡echny posÃ¡dky) |
| `/api/routes/{date}/{crewId}` | GET | PlÃ¡n dne (konkrÃ©tnÃ­ posÃ¡dka) |
| `/api/routes/{date}/{crewId}/reorder` | POST | ZmÄ›na poÅ™adÃ­ |
| `/api/routes/{date}/{crewId}/optimize` | POST | Re-optimalizace |
| `/api/slots/suggest` | POST | DoporuÄenÃ© sloty (V2) |
| `/api/export/googlemaps/{date}/{crewId}` | GET | Google Maps linky |
| `/api/export/pdf/{date}/{crewId}` | GET | PDF export |

---

## ShrnutÃ­ klÃ­ÄovÃ½ch rozhodnutÃ­

| Oblast | RozhodnutÃ­ |
|--------|------------|
| Entity | NezavÃ¡dÄ›t Job/Appointment, `Revision` je obojÃ­ |
| Stavy | Zachovat enum, â€ÄekÃ¡ na kontakt" = derived, â€odloÅ¾eno" = snooze_until |
| Sloty | Insertion heuristic + Valhalla cache (V2) |
| Multi-crew | MVP = ruÄnÃ­ + PSÄŒ regiony, V2 = clustering |
| Export | SegmentovanÃ© Google Maps (8-10 bodÅ¯) + PDF |
| MVP poÅ™adÃ­ | Queue â†’ Schedule â†’ DayPlan â†’ TechView |

---

## DalÅ¡Ã­ kroky

1. [x] ~~ZÃ­skat odpovÄ›di na otevÅ™enÃ© otÃ¡zky~~
2. [x] ~~Namapovat na existujÃ­cÃ­ datovÃ½ model~~
3. [ ] SchvÃ¡lit implementaÄnÃ­ plÃ¡n
4. [ ] DB migrace pro novÃ¡ pole
5. [ ] Implementace FÃ¡ze 1-5 (MVP)
6. [ ] TestovÃ¡nÃ­ s reÃ¡lnÃ½mi daty
7. [ ] Implementace FÃ¡ze 6 (Smart sloty)

---

## Jobs Dashboard (Phase 7D)

> **Status:** Partially implemented (Phase 7D core in `/jobs`)
> **UmÃ­stÄ›nÃ­:** `/admin/jobs` (souÄÃ¡st Admin sekce)

### ÃšÄel

CentralizovanÃ½ monitoring vÅ¡ech asynchronnÃ­ch Ãºloh zpracovÃ¡vanÃ½ch pÅ™es JetStream:
- Geocoding (Nominatim)
- Routing (Valhalla)
- Importy/Exporty
- Email/SMS (budoucÃ­)
- Exporty lze z historie stahovat pÅ™Ã­mo tlaÄÃ­tkem `StÃ¡hnout export` u dokonÄenÃ½ch export jobÅ¯

### Wireframe

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SAZINKA              ZÃ¡kaznÃ­ci  PlÃ¡n dne  KalendÃ¡Å™  Fronta  Admin         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€ Jobs Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚ â”‚
â”‚  â”‚  â”‚ Ve frontÄ›   â”‚ â”‚ ZpracovÃ¡nÃ­  â”‚ â”‚ DokonÄeno   â”‚ â”‚ Selhalo     â”‚      â”‚ â”‚
â”‚  â”‚  â”‚     12      â”‚ â”‚      3      â”‚ â”‚    1,247    â”‚ â”‚      5      â”‚      â”‚ â”‚
â”‚  â”‚  â”‚   â—‹ â—‹ â—‹     â”‚ â”‚   â— â— â—     â”‚ â”‚   âœ“ âœ“ âœ“     â”‚ â”‚   âœ— âœ—       â”‚      â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€ AktivnÃ­ Ãºlohy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ”„ Valhalla Matrix                                    3s ago â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ID: job-abc123                                               â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60%  Calculating distances...          â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                              [ZruÅ¡it]        â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“ Geocoding Batch                                   15s ago â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ID: job-def456                                               â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘ 85%  Geocoding customer 42/50...       â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                              [ZruÅ¡it]        â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ğŸ“¥ Import CSV                                        1m ago  â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ ID: job-ghi789                                               â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 40%  Processing row 200/500...         â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                              [ZruÅ¡it]        â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€ NedÃ¡vno dokonÄenÃ© â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ âœ“ Geocoding Batch                              2m ago  2.3s â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   25 customers geocoded, 2 failed                           â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ âœ“ Valhalla Geometry                            5m ago  1.1s â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Route for 12 stops calculated                             â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€ SelhanÃ© Ãºlohy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚ âœ— Valhalla Matrix                             10m ago        â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Error: Connection timeout after 30s                        â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚   Retries: 3/3                                               â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â”‚                                    [Opakovat]  [Zahodit]     â”‚  â”‚â”‚ â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚â”‚ â”‚
â”‚  â”‚  â”‚                                                                     â”‚â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚
â”‚  â”‚                                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DatovÃ© typy

```typescript
interface JobSummary {
  id: string;
  type: 'geocode' | 'geocode_address' | 'geocode_reverse' | 
        'valhalla_matrix' | 'valhalla_geometry' |
        'import' | 'export' | 'email' | 'sms';
  status: 'queued' | 'processing' | 'completed' | 'failed';
  progress?: number;        // 0-100
  message?: string;         // Current status message
  submittedAt: string;      // ISO timestamp
  startedAt?: string;
  completedAt?: string;
  durationMs?: number;
  error?: string;
  retryCount: number;
  maxRetries: number;
}

interface JobsDashboardStats {
  queued: number;
  processing: number;
  completed: number;
  failed: number;
}
```

### NATS Subjects

| Subject | Popis |
|---------|-------|
| `sazinka.admin.jobs.list` | Seznam aktivnÃ­ch Ãºloh |
| `sazinka.admin.jobs.stats` | Statistiky front |
| `sazinka.admin.jobs.cancel` | ZruÅ¡enÃ­ Ãºlohy |
| `sazinka.admin.jobs.retry` | OpakovÃ¡nÃ­ selhanÃ© Ãºlohy |

### UI komponenty

- [ ] `JobsDashboard` - hlavnÃ­ strÃ¡nka
- [ ] `JobStatsCards` - 4 karty se statistikami
- [ ] `ActiveJobsList` - seznam aktivnÃ­ch Ãºloh
- [ ] `CompletedJobsList` - nedÃ¡vno dokonÄenÃ©
- [ ] `FailedJobsList` - selhanÃ© Ãºlohy s akcemi
- [ ] `JobProgressBar` - progress bar s procentem
- [ ] `JobTypeIcon` - ikona podle typu Ãºlohy

### Integrace s existujÃ­cÃ­m Admin UI

Jobs Dashboard bude novÃ¡ zÃ¡loÅ¾ka v Admin sekci:

```
Admin
â”œâ”€â”€ PÅ™ehled (stÃ¡vajÃ­cÃ­)
â”œâ”€â”€ Export dat (stÃ¡vajÃ­cÃ­)
â”œâ”€â”€ Jobs Dashboard (novÃ©) â† Phase 7D
â””â”€â”€ NastavenÃ­ (stÃ¡vajÃ­cÃ­)
```

---

---

## Phase 8: GA Redesign - Route-Aware Planning

> **Status:** Planning phase  
> **Verze:** 1.0  
> **Datum:** 2026-02-02

### KlÃ­ÄovÃ½ koncept

**HlavnÃ­ zmÄ›na:** "Domluvit nÃ¡vÅ¡tÄ›vu" jiÅ¾ nenÃ­ oddÄ›lenÃ© od plÃ¡novÃ¡nÃ­ trasy - je to **jedna Äinnost**: vloÅ¾it zakÃ¡zku do dennÃ­ trasy s minimem Î”km/Î”min a s ohledem na ÄasovÃ¡ okna.

---

### 1. Persony

#### 1.1 DispeÄerka (primÃ¡rnÄ› desktop)

**Kontext:** PC, telefon, Äasto pÅ™epÃ­nÃ¡ mezi hovorem, mapou, seznamem a plÃ¡nem dne.

**CÃ­l:** Domluvit termÃ­ny a prÅ¯bÄ›Å¾nÄ› sklÃ¡dat dennÃ­ trasy pro 1â€“N posÃ¡dek tak, aby byl minimÃ¡lnÃ­ Äas/kilometry a pÅ™itom byla splnÄ›na okna a kapacita dne.

**KlÃ­ÄovÃ© potÅ™eby:**
- Rychle vidÄ›t kdo je na Å™adÄ› a proÄ (due, priorita)
- PÅ™i domluvÄ› hned vidÄ›t dopad na trasu: Î”km / Î”min a konflikty
- VidÄ›t kapacitu dne (vytÃ­Å¾enÃ­, rezerva/slack) a varovÃ¡nÃ­ "den je plnÃ½"
- Å˜eÅ¡it vÃ½jimky v mÃ­stÄ› (nelze geokÃ³dovat, chybÃ­ tel, zÃ¡kaznÃ­k chce zavolat pozdÄ›ji)
- Minimum scrollu, maximum informaÄnÃ­ hustoty, klÃ¡vesovÃ© zkratky

**TypickÃ© chovÃ¡nÃ­:**
- Vybere den + posÃ¡dku + depo â†’ vybÃ­rÃ¡ zÃ¡kaznÃ­ky z inboxu tak, aby "sedÄ›li" do trasy
- V hovoru nabÃ­dne 3 nejlepÅ¡Ã­ sloty, ne celÃ½ kalendÃ¡Å™
- KdyÅ¾ nÄ›co "nesedÃ­", odloÅ¾Ã­ nebo pÅ™ehodÃ­ na jinÃ½ den/posÃ¡dku

#### 1.2 Å˜emeslnÃ­k (primÃ¡rnÄ› mobil)

**Kontext:** MobilnÃ­ web, Äasto venku; potÅ™ebuje rychle navigovat, volat, vidÄ›t poznÃ¡mky a uzavÅ™Ã­t zakÃ¡zku.

**CÃ­l:** ProvÃ©st nÃ¡vÅ¡tÄ›vy, minimalizovat zmatky, mÃ­t vÅ¡echny informace dostupnÃ© (kontakt, adresa, poznÃ¡mky, zaÅ™Ã­zenÃ­, historie), rychle zaznamenat vÃ½sledek.

**KlÃ­ÄovÃ© potÅ™eby:**
- DneÅ¡nÃ­ plÃ¡n: poÅ™adÃ­, okna, Äas dojezdu, navigace
- Jedno kliknutÃ­: Navigovat, Volat, Na mÃ­stÄ›, Hotovo
- PoznÃ¡mky typu "parkovÃ¡nÃ­ / klÃ­Äe / pÅ™Ã­stup" zvÃ½raznÄ›nÃ©
- I bez mobilnÃ­ aplikace: export (odkaz/Google Maps) a offline-ish "tisk/PDF"

---

### 2. NÃ¡zvoslovÃ­ (sjednocenÃ­)

| UI termÃ­n | Popis | MapovÃ¡nÃ­ na DB |
|-----------|-------|----------------|
| **ZÃ¡kaznÃ­k** | Osoba nebo firma | `Customer` |
| **ZaÅ™Ã­zenÃ­** | Kotel, komÃ­n, plynovÃ½ spotÅ™ebiÄ | `Device` |
| **ZakÃ¡zka** | Co se mÃ¡ udÄ›lat (revize/servis/ÄiÅ¡tÄ›nÃ­) | `Revision` |
| **NÃ¡vÅ¡tÄ›va** | DomluvenÃ© datum + ÄasovÃ© okno + dÃ©lka + posÃ¡dka | `Visit` |
| **PlÃ¡n dne** | KonkrÃ©tnÃ­ trasa pro den a posÃ¡dku (sekvence nÃ¡vÅ¡tÄ›v + metriky) | `PlannedRoute` |
| **PlÃ¡novacÃ­ inbox** | Seznam zakÃ¡zek k domluvenÃ­/vloÅ¾enÃ­ do trasy | Query over `Revision` |

---

### 3. StavovÃ© signÃ¡ly (konzistentnÃ­ napÅ™Ã­Ä aplikacÃ­)

#### 3.1 Stav adresy

| Stav | Ikona | Popis |
|------|-------|-------|
| OvÄ›Å™eno | âœ… | MÃ¡ geo a proÅ¡la validacÃ­ |
| ÄŒekÃ¡ na ovÄ›Å™enÃ­ | â³ | GeokÃ³dovÃ¡nÃ­ pending |
| Nelze lokalizovat | âš  | GeokÃ³d selhal |
| Bez adresy | â›” | Nelze optimalizovat |

#### 3.2 Stav vloÅ¾enÃ­ slotu do trasy

| Stav | Ikona | PodmÃ­nky |
|------|-------|----------|
| OK | âœ… | Bez konfliktu, vytÃ­Å¾enÃ­ â‰¤90%, slack â‰¥20 min |
| TÄ›snÃ© | âš  | VytÃ­Å¾enÃ­ 90â€“100% nebo slack 10â€“20 min |
| Konflikt | âŒ | PoruÅ¡enÃ­ okna nebo vytÃ­Å¾enÃ­ >100% |

#### 3.3 Kapacita dne

| Stav | Ikona | PodmÃ­nky |
|------|-------|----------|
| V pohodÄ› | âœ… | load <80%, slack >30 min |
| TÄ›snÃ½ | âš  | load 80â€“95% nebo slack 15â€“30 min |
| PÅ™etÃ­Å¾enÃ½ | âŒ | load >95% nebo slack <15 min |

---

### 4. Design principy pro GA

#### 4.1 TÅ™i zÃ¡sadnÃ­ UX pravidla

1. **Route-aware vÅ¡ude tam, kde se domlouvÃ¡ termÃ­n**
   - "Domluvit" vÅ¾dy ukazuje dopad na trasu

2. **VÃ½jimky Å™eÅ¡itelnÃ© pÅ™Ã­mo v mÃ­stÄ›**
   - Nelze geokÃ³dovat â†’ okamÅ¾itÄ› "Opravit adresu" a pokraÄovat

3. **Desktop je hustÃ½ a rychlÃ½; mobil je rovnocennÃ½, jen jinak posklÃ¡danÃ½**
   - Ne "desktop jako zvÄ›tÅ¡enÃ½ mobil"

#### 4.2 ExplicitnÃ­ "Route-aware" reÅ¾im

V Inboxu i v DomluvÄ› termÃ­nu bude pÅ™epÃ­naÄ:

```
Optimalizovat podle trasy: [Zapnuto]
```

KdyÅ¾ je **OFF**:
- Sloty nemajÃ­ Î”km/Î”min, jen "ÄasovÃ½ konflikt"
- UI ukÃ¡Å¾e InlineAlert: "Bez ovÄ›Å™enÃ© adresy nelze optimalizovat. Opravit adresu."

---

### 5. KomponentovÃ½ katalog

#### 5.1 ZÃ¡kladnÃ­ layoutovÃ© komponenty

| Komponenta | Popis |
|------------|-------|
| `AppShell` | Top nav, breadcrumb slot, content container, dense mÃ³d |
| `SplitView` | Desktop: 2â€“3 panely (Inbox / Map / Detail) |
| `RightDrawer` / `BottomSheet` | JednotnÃ¡ logika otevÅ™enÃ­/zavÅ™enÃ­, focus trap, ESC |

#### 5.2 Route-aware plÃ¡novÃ¡nÃ­

| Komponenta | Popis |
|------------|-------|
| `RouteContextHeader` | Sticky nahoÅ™e: Den, PosÃ¡dka, Depo + souhrn metrik |
| `CandidateRow` | Å˜Ã¡dek v inboxu: jmÃ©no, mÄ›sto, due, Î”km, Î”min, slot chips |
| `RouteMap` | Mapa s ÄÃ­slovanÃ½mi piny + polyline + insertion preview |
| `SlotSuggestions` | NabÃ­dka 3â€“5 slotÅ¯ s metrikami a stavy |
| `InsertionPreview` | Mini panel "vloÅ¾Ã­ se mezi: 3 (Jana) â†’ 4 (Michaela)" |

#### 5.3 StavovÃ© komponenty

| Komponenta | Popis |
|------------|-------|
| `StatusChip` | Badge pro adresu/zakÃ¡zku/kapacitu se stavem |
| `InlineAlert` | KrÃ¡tkÃ© vysvÄ›tlenÃ­ problÃ©mu + CTA |
| `MetricBadge` | Pro Î”km/Î”min a dennÃ­ metriky |

#### 5.4 Data grid

| Komponenta | Popis |
|------------|-------|
| `CustomerTable` | TanStack Table s bohatÃ½mi buÅˆkami |
| `CustomerPreviewPanel` | ShrnutÃ­ + CTA v side panelu |
| `CustomerEditDrawer` | Editace + ovÄ›Å™enÃ­ adresy |

---

### 6. KlÃ¡vesovÃ© zkratky (dispeÄerka / desktop)

#### 6.1 GlobÃ¡lnÃ­

| Zkratka | Akce |
|---------|------|
| `/` | Focus do search |
| `g i` | Go to Inbox |
| `g c` | Go to Customers |
| `g d` | Go to Day plan |

#### 6.2 Inbox

| Zkratka | Akce |
|---------|------|
| `â†‘` / `â†“` | VÃ½bÄ›r kandidÃ¡ta |
| `Enter` | OtevÅ™Ã­t detail |
| `1`..`5` | Vybrat doporuÄenÃ½ slot |
| `D` | OtevÅ™Ã­t "Domluvit" |
| `S` | UloÅ¾it/"Domluvit" (commit) |
| `O` | OtevÅ™Ã­t "OdloÅ¾it" |
| `E` | "Opravit adresu" |
| `Esc` | ZavÅ™Ã­t drawer/modal |

#### 6.3 PlÃ¡n dne

| Zkratka | Akce |
|---------|------|
| `Ctrl+S` | UloÅ¾it plÃ¡n |
| `R` | Re-optimalizovat |
| `P` | Tisk |
| `M` | Export do Google Maps |

---

### 7. Metriky kapacity a jak je ukazovat

#### 7.1 Metriky v RouteContextHeader

```
51 km â€¢ jÃ­zda 1h16 â€¢ servis 5h30 â€¢ vytÃ­Å¾enÃ­ 92% âš  â€¢ rezerva 18 min âš 
```

| Metrika | Popis |
|---------|-------|
| VzdÃ¡lenost (km) | SouÄet vÅ¡ech ÃºsekÅ¯ trasy |
| ÄŒas jÃ­zdy (travel time) | Z Valhalla matrix |
| ServisnÃ­ Äas | SouÄet service duration vÅ¡ech zastÃ¡vek |
| VytÃ­Å¾enÃ­ dne (load %) | (jÃ­zda + servis + pauzy) / pracovnÃ­ doba |
| Rezerva (slack) | NejmenÅ¡Ã­ ÄasovÃ¡ rezerva mezi nÃ¡vÅ¡tÄ›vami |

#### 7.2 Tooltip vysvÄ›tlenÃ­

- **VytÃ­Å¾enÃ­:** "VytÃ­Å¾enÃ­ = (jÃ­zda + servis + pauzy) / pracovnÃ­ doba dne"
- **Rezerva:** "NejmenÅ¡Ã­ ÄasovÃ¡ rezerva mezi nÃ¡vÅ¡tÄ›vami vzhledem k ÄasovÃ½m oknÅ¯m; nÃ­zkÃ¡ rezerva = riziko skluzu"

---

### 8. StrÃ¡nky - detailnÃ­ popis a wireframes

#### 8.1 PlÃ¡novacÃ­ inbox (route-aware)

**ÃšÄel:** Domluvit/vloÅ¾it zakÃ¡zky do konkrÃ©tnÃ­ dennÃ­ trasy s minimÃ¡lnÃ­m dopadem na km/Äas.

**Desktop layout (3 panely):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PlÃ¡novacÃ­ inbox  Den[St 5.3] PosÃ¡dka[1] Depo[Brno]  Route-aware[ON] [Filtry]â”‚
â”‚ 51 km â€¢ jÃ­zda 1h16 â€¢ servis 5h30 â€¢ vytÃ­Å¾enÃ­ 92%âš  â€¢ rezerva 18mâš           â”‚
â”‚ [Po termÃ­nu(12)] [TÃ½den(18)] [30 dnÃ­(43)] [VÅ¡e] [OdloÅ¾enÃ©] [ProblÃ©my]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ INBOX         â”‚ MAPA + TRASA DNE                           â”‚ DETAIL      â”‚
â”‚ Jana NovotnÃ¡  â”‚ piny 1..N + highlight kandidÃ¡t             â”‚ Jana NovotnÃ¡â”‚
â”‚ +3.2km +6min âœ…â”‚ nÃ¡vrh vloÅ¾enÃ­ mezi 3â†’4                     â”‚ Sloty:      â”‚
â”‚ 10â€“12âœ… 12â€“14âš  â”‚                                           â”‚ 10â€“12 âœ… +6m â”‚
â”‚               â”‚                                           â”‚ 12â€“14 âš  +14mâ”‚
â”‚ Michaelaâ€¦     â”‚                                           â”‚ 8â€“10 âŒ      â”‚
â”‚ +7.8km +14mâš   â”‚                                           â”‚ [DOMLUVIT]  â”‚
â”‚               â”‚                                           â”‚ [ODLOÅ½IT]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mobile layout:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Inbox  Den [..] PosÃ¡dka [1]     â”‚
â”‚ Kapacita 92% âš                â”‚
â”‚ [Seznam] [Mapa]              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (karty s Î”km/Î”min)            â”‚
â”‚ Jana NovotnÃ¡  +6m +3.2km âœ…   â”‚
â”‚ [Domluvit] [OdloÅ¾it]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Segmenty:**
- Po termÃ­nu / Tento tÃ½den / Do 30 dnÃ­ / VÅ¡e / OdloÅ¾enÃ© / ProblÃ©my

**UI stavy:**
1. `context=missing` - VyÅ¾aduje vÃ½bÄ›r dne+posÃ¡dky
2. `context=ready, route=loading` - Skeleton metrik a mapy
3. `route=ready, inbox=ready` - KandidÃ¡ti seÅ™azenÃ­ dle "nejlepÅ¡Ã­ vloÅ¾enÃ­"
4. `candidate=selected, suggestions=loading` - DotekajÃ­ sloty
5. `routeAware=forcedOff` - ChybÃ­ geo, banner s vysvÄ›tlenÃ­m
6. `capacity=warn|danger` - VarovÃ¡nÃ­ v headeru

---

#### 8.2 PÅ™ehled cest / Planner (`/planner`)

**ÃšÄel:** PÅ™ehled naplÃ¡novanÃ½ch cest s filtrovÃ¡nÃ­m. ProhlÃ­Å¾enÃ­ tras s detailnÃ­ Äasovou osou a vizualizacÃ­ na mapÄ›.

**Desktop layout (2 sloupce: sidebar + mapa):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LEVÃ SLOUPEC (sidebar)               â”‚  PRAVÃ SLOUPEC (mapa)            â”‚
â”‚                                        â”‚                                  â”‚
â”‚  FILTRY                                â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  [Datum ____] [... rozsah]             â”‚  â”‚                          â”‚   â”‚
â”‚  [PosÃ¡dka: VÅ¡e â–¾] [Depo: VÅ¡e â–¾]       â”‚  â”‚      MAPA S TRASOU       â”‚   â”‚
â”‚                                        â”‚  â”‚   (piny + segmenty)      â”‚   â”‚
â”‚  NAPLÃNOVANÃ‰ CESTY (N)  [â†»]           â”‚  â”‚                          â”‚   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚   â‘ â”€â”€â‘¡â”€â”€â‘¢â”€â”€â‘£â”€â”€ğŸ          â”‚   â”‚
â”‚  â”‚ Po 2.2. â€¢ PosÃ¡dka 1 â€¢ 3 zast.   â”‚  â”‚  â”‚                          â”‚   â”‚
â”‚  â”‚ 45 km â€¢ 2h30                     â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚                                  â”‚
â”‚  â”‚ Ãšt 3.2. â€¢ PosÃ¡dka 1 â€¢ 5 zast.   â”‚  â”‚                                  â”‚
â”‚  â”‚ 78 km â€¢ 4h15                     â”‚  â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚
â”‚                                        â”‚                                  â”‚
â”‚  DETAIL TRASY           45 km Â· 2h30   â”‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                                  â”‚
â”‚  â”‚ ğŸ  Depo Brno                     â”‚  â”‚                                  â”‚
â”‚  â”‚ â”€â”€â”€ 12 km Â· 18 min â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚                                  â”‚
â”‚  â”‚ â‘  Jan NovÃ¡k    08:30â€“09:15      â”‚  â”‚                                  â”‚
â”‚  â”‚   LesnÃ­ 123, Brno  [Potvrzeno]  â”‚  â”‚                                  â”‚
â”‚  â”‚ â”€â”€â”€ 8 km Â· 12 min â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚                                  â”‚
â”‚  â”‚ â‘¡ Marie Svob.  09:45â€“10:15     â”‚  â”‚                                  â”‚
â”‚  â”‚   HlavnÃ­ 45     [Nepotvrzeno]   â”‚  â”‚                                  â”‚
â”‚  â”‚ â”€â”€â”€ 15 km Â· 22 min â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚                                  â”‚
â”‚  â”‚ â‘¢ Petr ÄŒernÃ½   10:50â€“11:35     â”‚  â”‚                                  â”‚
â”‚  â”‚   NÃ¡draÅ¾nÃ­ 8    [Potvrzeno]     â”‚  â”‚                                  â”‚
â”‚  â”‚ â”€â”€â”€ 10 km Â· 15 min â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚                                  â”‚
â”‚  â”‚ ğŸ  Depo Brno                     â”‚  â”‚                                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Filtry:**
- **Den**: vÃ½bÄ›r jednoho dne s moÅ¾nostÃ­ pÅ™epnout na rozsah
- **PosÃ¡dka**: defaultnÄ› "VÅ¡e", vÃ½bÄ›r z existujÃ­cÃ­ch posÃ¡dek
- **Depo**: defaultnÄ› "VÅ¡e", vÃ½bÄ›r z existujÃ­cÃ­ch dep
- UÅ¾ivatelskÃ© preference (defaultnÃ­ posÃ¡dka, depo) se naÄtou ze Settings jako vÃ½chozÃ­ hodnoty

**Interakce:**
- KliknutÃ­ na trasu v seznamu zobrazÃ­ jejÃ­ detail v dolnÃ­ ÄÃ¡sti sidebaru
- KliknutÃ­ na zastÃ¡vku v timeline zvÃ½raznÃ­ mÃ­sto na mapÄ› a pÅ™eletÃ­ na nÄ›j
- KliknutÃ­ na segment v timeline zvÃ½raznÃ­ Ãºsek cesty na mapÄ›
- KliknutÃ­ na segment cesty na mapÄ› zobrazÃ­ info o Ãºseku

**Komponenty (sdÃ­lenÃ© s Inbox):**
- `RouteListPanel` â€” seznam tras s kartami (datum, posÃ¡dka, zastÃ¡vky, vzdÃ¡lenost, Äas)
- `RouteDetailTimeline` â€” sdÃ­lenÃ¡ vertikÃ¡lnÃ­ timeline: depo â†’ segment (Äas odâ€“do, km, trvÃ¡nÃ­) â†’ zastÃ¡vka (status badge, dohodnutÃ©/vypoÄÃ­tanÃ© Äasy, warning ikona pÅ™i rozdÃ­lu >15 min) â†’ ... â†’ depo
  - Ve spodnÃ­m route summary: `VzdÃ¡lenost`, `CelkovÃ½ Äas`, `ZatÃ­Å¾enÃ­` + sekundÃ¡rnÃ­ Ãºdaj `z toho jÃ­zda`
  - SjednocenÃ© akce na obou strÃ¡nkÃ¡ch: `Optimalizovat`, `PÅ™idat pauzu`, `Smazat trasu`
- `RouteMapPanel` â€” sdÃ­lenÃ¡ mapa MapLibre GL (piny, segmenty, polyline, highlight, v Inbox navÃ­c selectedCandidate a insertionPreview)
- Bidirectional highlight: klik v timeline â†” zvÃ½raznÄ›nÃ­ na mapÄ›, klik na segment/zastÃ¡vku na mapÄ› â†” zvÃ½raznÄ›nÃ­ v timeline
- VRP optimalizace s pauzou: opraven backend payload pauzy pro `vrp-pragmatic` (required break), aby se optimalizace nepÅ™epÃ­nala na heuristickÃ½ fallback kvÅ¯li chybÄ› deserializace

**NastavenÃ­ uÅ¾ivatele (Settings â†’ Moje nastavenÃ­):**
- DefaultnÃ­ posÃ¡dka a depo se uklÃ¡dajÃ­ do DB (`users.default_crew_id`, `users.default_depot_id`)
- PouÅ¾Ã­vajÃ­ se jako vÃ½chozÃ­ filtry na strÃ¡nce Planner
- UÅ¾ivatel mÅ¯Å¾e filtrovat i jinÃ© posÃ¡dky/depa â€” preference nejsou tvrdÃ¡ vazba

---

#### 8.3 Seznam zÃ¡kaznÃ­kÅ¯

**ÃšÄel:** Katalog pro dohledÃ¡nÃ­ a ÃºdrÅ¾bu dat.

**Desktop (tabulka):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZÃ¡kaznÃ­ci  [ğŸ” hledatâ€¦____________________] [Saved â–¾] [Filtry] â”‚
â”‚ [Å˜adit â–¾] [Tabulka|Karty]                               [+NovÃ½]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ZÃKAZNÃK             | MÄšSTO | ZAÅ˜. | NEJBL. ZAK. | ADRESA | â‹¯ â”‚
â”‚ Alena HÃ¡jek          | HodonÃ­n| 2    | 3.1.2027    | âœ…     | â‹¯ â”‚
â”‚ +420â€¦ â€¢ emailâ€¦ â€¢ U PoÅ¡ty 220â€¦                               â€¦ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ (klik Å™Ã¡dku)                   â”‚ NÃ¡hled zÃ¡kaznÃ­ka (panel)      â”‚
â”‚                                â”‚ kontakt, adresa, CTA          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Mobile (karty):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ZÃ¡kaznÃ­ci                    â”‚
â”‚ [ğŸ” hledatâ€¦_______________]   â”‚
â”‚ [Bez adresy] [Nelze loc] [Po]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Alena HÃ¡jek (Osoba)          â”‚
â”‚ HodonÃ­n â€¢ U PoÅ¡ty 220â€¦       â”‚
â”‚ âœ… OvÄ›Å™eno â€¢ ZaÅ™Ã­zenÃ­ 2      â”‚
â”‚ NejbliÅ¾Å¡Ã­: 3.1.2027          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 8.4 Detail zÃ¡kaznÃ­ka (workspace + edit drawer)

**ÃšÄel:** RychlÃ½ pÅ™ehled + zaÅ™Ã­zenÃ­ + historie + komunikace; editace v draweru.

**Desktop (2 sloupce + taby):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ZpÄ›t  Alena HÃ¡jek [OSOBA]  [ğŸ“] [ğŸ§­] [â• do plÃ¡nu] [âœ Upravit] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Kontakt               â”‚ [ZaÅ™Ã­zenÃ­] [ZakÃ¡zky&NÃ¡vÅ¡tÄ›vy] [Komunik.]â”‚
â”‚ +420â€¦ (kopÃ­rovat)     â”‚ â”€ ZaÅ™Ã­zenÃ­ (kompaktnÃ­ Å™Ã¡dky)            â”‚
â”‚ emailâ€¦                â”‚ Kotelâ€¦  Interval 12  DalÅ¡Ã­: â€¦  [Domluvit]â”‚
â”‚ Adresa âœ… OvÄ›Å™eno      â”‚ KomÃ­nâ€¦  Interval 24  DalÅ¡Ã­: â€¦  [Domluvit]â”‚
â”‚ U PoÅ¡ty 220â€¦ [Opravit] â”‚                                          â”‚
â”‚ Mini mapa [OtevÅ™Ã­t]   â”‚                                          â”‚
â”‚ PoznÃ¡mkyâ€¦             â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Editace:** PravÃ½ drawer se sekcemi "ZÃ¡klad", "Kontakt", "Adresa + ovÄ›Å™enÃ­", "PoznÃ¡mky"

**MazÃ¡nÃ­ zÃ¡kaznÃ­ka (aktuÃ¡lnÃ­ UX):**

- V headeru detailu je akce pro smazÃ¡nÃ­ zÃ¡kaznÃ­ka (anonymizace).
- Po kliknutÃ­ se otevÅ™e potvrzovacÃ­ dialog s upozornÄ›nÃ­m, Å¾e akce je nevratnÃ¡ a osobnÃ­ Ãºdaje budou trvale anonymizovÃ¡ny bez moÅ¾nosti undo.
- Po potvrzenÃ­ zÃ¡kaznÃ­k zmizÃ­ ze seznamÅ¯/UI, ale historickÃ¡ navÃ¡zanÃ¡ data zÅ¯stÃ¡vajÃ­ zachovÃ¡na v anonymizovanÃ© podobÄ›.
- UX copy explicitnÄ› komunikuje, Å¾e jde o anonymizaci PII (GDPR-style), ne fyzickÃ© odstranÄ›nÃ­ historickÃ½ch vazeb.

---

#### 8.5 Domluvit termÃ­n (vloÅ¾it do trasy) - dialog/panel

**ÃšÄel:** JednÃ­m rozhodnutÃ­m vybrat slot a vloÅ¾it do trasy.

**Desktop (inline panel):**

```
Domluvit termÃ­n
DoporuÄenÃ©: [Ãšt 10â€“12 âœ… +6m/+3.2km] [St 8â€“10 âœ… +0m] [ÄŒt 12â€“14 âŒ]
Datum [..]  Okno [10:00]â€“[12:00]  Doba [30m]  (PosÃ¡dka/Depo dle kontextu)
Stav: âœ… OK (rezerva 18 min)
[ZruÅ¡it]                         [Domluvit]
```

**Mobile (full-screen sheet):**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Domluvit termÃ­n              â”‚
â”‚ DoporuÄenÃ©:                  â”‚
â”‚ [St 8â€“10 âœ…] [Ãšt 10â€“12 âœ…]     â”‚
â”‚ Datum [..] Okno [..]â€“[..]     â”‚
â”‚ Doba [30m]                    â”‚
â”‚ Stav: OK (+6m / +3.2km)       â”‚
â”‚ [ZruÅ¡it]         [Domluvit]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

#### 8.6 OdloÅ¾it akci - dialog

**ÃšÄel:** OdloÅ¾it dalÅ¡Ã­ krok zakÃ¡zky do data s dÅ¯vodem.

```
OdloÅ¾it akci
OdloÅ¾it do: [dd.mm.rrrr]  Rychle: [+7] [+14] [+30]
DÅ¯vod: [NezvedÃ¡ â–¾]
PoznÃ¡mka: [__________]
[ZruÅ¡it]            [OdloÅ¾it]
```

**DÅ¯vody:** NezvedÃ¡, DovolenÃ¡, Chce zavolat pozdÄ›ji, JinÃ½

---

#### 8.7 Detail zakÃ¡zky (workflow hub)

**ÃšÄel:** CentrÃ¡lnÃ­ detail toho, co se mÃ¡ udÄ›lat.

**Desktop:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ZpÄ›t  ZakÃ¡zka: Revize plynovÃ©ho kotle  [NADCHÃZEJÃCÃ]       â”‚
â”‚ Due: 26.2.2026   [Domluvit termÃ­n] [OdloÅ¾it] [ZruÅ¡it â‹¯]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ZÃ¡kaznÃ­k + ZaÅ™Ã­zenÃ­      â”‚ NÃ¡vÅ¡tÄ›va                           â”‚
â”‚ HustopeÄeâ€¦ âœ… adresa      â”‚ St 5.3. 10â€“12  Doba 30m  PosÃ¡dka 1     â”‚
â”‚ Kontaktâ€¦                 â”‚ [ZmÄ›nit] [OtevÅ™Ã­t plÃ¡n dne]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [PrÅ¯bÄ›h/VÃ½sledek] [Komunikace] [Historie]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**KontextovÃ© akce dle stavu:**
- `upcoming` â†’ "Domluvit termÃ­n"
- `scheduled` â†’ "ZmÄ›nit termÃ­n", "PÅ™esunout"
- `in_progress` â†’ "Na mÃ­stÄ›", "Hotovo"
- `completed` â†’ "Zobrazit vÃ½sledek"

---

### 9. UI stavovÃ© modely

#### 9.1 PlÃ¡novacÃ­ inbox - stavy

| Stav | UI | Akce | Fallback |
|------|-----|------|----------|
| `context=missing` | VyÅ¾aduje vÃ½bÄ›r dne+posÃ¡dky | Vybrat | - |
| `route=loading` | Skeleton metrik | ÄŒekat | - |
| `route=ready` | KandidÃ¡ti seÅ™azenÃ­ | Vybrat kandidÃ¡ta | - |
| `suggestions=loading` | Skeleton slotÅ¯ | ÄŒekat | - |
| `routeAware=forcedOff` | Banner "bez optimalizace" | Opravit adresu | Domluvit bez Î” |
| `capacity=warn` | Chip v headeru | PÅ™epnout posÃ¡dku/den | - |

#### 9.2 Optimistic UI

**Ano (optimistic):**
- VloÅ¾it do dne / domluvit
- OdloÅ¾it
- UloÅ¾enÃ­ poznÃ¡mky

**Ne (neoptimistic):**
- Editace adresy + ovÄ›Å™enÃ­
- Reorder celÃ© trasy (draft mÃ³d)

---

### 10. Empty states a edge cases

#### 10.1 Inbox je prÃ¡zdnÃ½

```
Inbox je prÃ¡zdnÃ½ â€“ na tento den nejsou Å¾Ã¡dnÃ© poloÅ¾ky k domluvenÃ­.
[Zobrazit dalÅ¡Ã­ obdobÃ­] [PÅ™ejÃ­t na ZÃ¡kaznÃ­ky]
```

#### 10.2 Nelze geokÃ³dovat

```
âš  Adresu se nepodaÅ™ilo ovÄ›Å™it. Do optimalizace trasy se nezahrne.
[Opravit adresu]
```

#### 10.3 ChybÃ­ telefon

```
âš  ZÃ¡kaznÃ­k nemÃ¡ telefon. Nelze obvolat.
[Doplnit telefon]
```

#### 10.4 Den je plnÃ½

```
âŒ Den je tÃ©mÄ›Å™ plnÃ½ (92%). DoporuÄeno pÅ™idat max. 1 krÃ¡tkou nÃ¡vÅ¡tÄ›vu v okolÃ­.
```

---

### 11. DoporuÄenÃ© UI knihovny

| Knihovna | ÃšÄel |
|----------|------|
| shadcn/ui + Radix UI | Dostupnost, modernÃ­ vzhled |
| Tailwind CSS | KonzistentnÃ­ spacing |
| TanStack Table | Tabulka zÃ¡kaznÃ­kÅ¯ |
| React Query | CachovÃ¡nÃ­, optimistic updates |
| React Hook Form + Zod | FormulÃ¡Å™e + validace |
| date-fns | Data/Äasy |
| Zustand | UI stav (den/posÃ¡dka, panely, filtry) |
| react-virtuoso | Virtualizace dlouhÃ½ch seznamÅ¯ |

---

*Dokument vytvoÅ™en: 2026-01-31*  
*PoslednÃ­ aktualizace: 2026-02-12 (Routing accuracy, break chronological placement, timeline UX improvements, insertion preview dedup)*
